<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />








  <meta property="fb:admins" content="100035055370515" />
  <meta property="fb:app_id" content="473188823418438" />



<meta name="description" content="我听说虫洞可以穿梭时空">
<meta property="og:type" content="website">
<meta property="og:title" content="在人间漂流">
<meta property="og:url" content="https://brooksj.com/page/2/index.html">
<meta property="og:site_name" content="在人间漂流">
<meta property="og:description" content="我听说虫洞可以穿梭时空">
<meta property="article:author" content="brooksj">
<meta property="article:tag" content="hiphop | rock | basketball | movie">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://brooksj.com/page/2/"/>





<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

  <title>在人间漂流</title>
  
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '473188823418438',
      xfbml      : true,
      version    : 'v2.10'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/zh_Hans/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>









<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">


  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <!-- fork me on github -->
    <!-- a href="https://github.com/tracy-talent"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_left_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a -->
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">在人间漂流</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">厚德 求真 励学 笃行</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <a href="https://github.com/tracy-talent" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
    </a>
    <style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/09/01/spark-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/01/spark-tips/" itemprop="url">spark tips</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-01T22:18:19+08:00">
                2019-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Distributed-System/" itemprop="url" rel="index">
                    <span itemprop="name">Distributed System</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Distributed-System/Bigdata-Technology/" itemprop="url" rel="index">
                    <span itemprop="name">Bigdata Technology</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/01/spark-tips/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/09/01/spark-tips/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/09/01/spark-tips/" class="leancloud_visitors" data-flag-title="spark tips">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">710(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">3(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="spark-tips"><a href="#spark-tips" class="headerlink" title="spark tips"></a>spark tips</h1><h3 id="jar包上传到hdfs"><a href="#jar包上传到hdfs" class="headerlink" title="jar包上传到hdfs"></a>jar包上传到hdfs</h3><ul>
<li>分布式集群上跑spark时每次都要将${SPARK_HOME}/jars/<em>下所有的jar包上传到分布式系统中供调用，为了避免每次的上传时间可以将这些jar包存放到hdfs中，==注意：我在2.\</em>的版本中将所有jar包打包成.archive文件上传到hdfs，但是这样做导致spark在yarn上启动失败，后来尝试将这些jar包分散上传到hdfs的文件夹下就能正常在yarn上启动spark了。==具体做法如下：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">将$&#123;SPARK_HOME&#125;/jars下的所有jar包上传到hdfs中：</span><br><span class="line">hadoop fs -put jars/* /spark</span><br><span class="line">在$&#123;SPARK_HOME&#125;/conf/spark-defaults.conf中添加配置项：</span><br><span class="line">spark.yarn.jars  hdfs://localhost:9000/spark/jars/*</span><br></pre></td></tr></table></figure>
<ul>
<li>如果要使用hbase则需要将hbase的lib目录下hbase开头的jar包和guava-{version}.jar、protobuf-java-{version}.jar上传到hdfs上的同一目录jars，hbase.xml复制一份到hadoop的配置文件目录etc/hadoop下</li>
</ul>
<h2 id="spark-on-yarn"><a href="#spark-on-yarn" class="headerlink" title="spark on yarn"></a>spark on yarn</h2><h3 id="1-调参"><a href="#1-调参" class="headerlink" title="1. 调参"></a>1. 调参</h3><h4 id="1-1-client-mode"><a href="#1-1-client-mode" class="headerlink" title="1.1 client mode"></a>1.1 client mode</h4><ul>
<li>client mode下，spark的driver与applicationmaster是分离的，要分别设置内存大小。任务提交的同时driver就开始运行了，所以driver内存不可以在程序里使用SparkConf类设置，可通过spark-defaults.conf或者CLI下—driver-memory配置，而applicationmaster的内存大小没有限制可以在SparkConf里面通过spark.yarn.am.memory来配置</li>
</ul>
<h4 id="1-2-cluster-mode"><a href="#1-2-cluster-mode" class="headerlink" title="1.2 cluster mode"></a>1.2 cluster mode</h4><ul>
<li>cluster mode下，spark的driver和applicationmaster在同一个container里面，可以通过在SparkConf，spark-defaults.conf或者CLI下用spark.yarn.am.memory来对这个container内存大小进行配置</li>
</ul>
<h4 id="1-3-CLI参数设置"><a href="#1-3-CLI参数设置" class="headerlink" title="1.3 CLI参数设置"></a>1.3 CLI参数设置</h4><blockquote>
<p>spark在yarn上运行能使用的container数目是由核数vcores和executor内存大小共同决定的，由于hadoop不像spark，hadoop可以设置一个结点的总内存和核数，所以当cpu或者内存资源超过设置的额度时会限制container到尽可能大的数目</p>
</blockquote>
<ul>
<li>—num-executors设置executor数目</li>
<li>—executor-memory设置executor内存</li>
<li>—executor-cores设置executor核数</li>
<li>—conf spark.yarn.am.memory=2g设置application master内存大小</li>
<li>—conf spark.yarn.am.cores=2设置application master核数</li>
</ul>
<h4 id="1-4-运行方式"><a href="#1-4-运行方式" class="headerlink" title="1.4 运行方式"></a>1.4 运行方式</h4><ul>
<li>cluster</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-submit --class &lt;yourclass&gt; --master yarn --deploy-mode cluster --conf spark.yarn.am.memory=2g --executor-memory 2g --executor-cores 2 &lt;yourjar&gt; &lt;args&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>client</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-submit --class &lt;yourclass&gt; --master yarn --deploy-mode client --driver-meemoty 2g --executor-memory 2g --executor-cores 2 &lt;yourjar&gt; &lt;args&gt;</span><br></pre></td></tr></table></figure>
<h2 id="spark-standalone"><a href="#spark-standalone" class="headerlink" title="spark standalone"></a>spark standalone</h2><h3 id="1-调参-1"><a href="#1-调参-1" class="headerlink" title="1.调参"></a>1.调参</h3><ul>
<li><p>spark无需像mapreduce那样给每个节点设置总的内存限制，spark总内存使用会自动扩展。</p>
</li>
<li><p>spark集群总核数无需配置，自动识别集群中所有机器的虚拟内核数</p>
</li>
<li><p>spark的executor数目由集群中的总核数和exexutor的核数决定：</p>
<script type="math/tex; mode=display">
num-executors = cores-in-cluster/executor.cores</script></li>
<li><p>executor.memory不等于RDD可用的memory size，因为JVM等也需要占据一定内存资源，差不多只能用一半，driver.memory也一样</p>
</li>
<li><p>运行方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-submit --class &lt;yourclass&gt; --master spark://slave103:7077 --conf spark.driver.memery=6g --conf spark.executor.memory=2g --conf spark.executor.cores=2 &lt;yourjar&gt; &lt;args&gt;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/09/01/tensorboard-tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/01/tensorboard-tutorial/" itemprop="url">TensorBoard tutorial</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-01T22:15:20+08:00">
                2019-09-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine Learning</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/Tensorflow/" itemprop="url" rel="index">
                    <span itemprop="name">Tensorflow</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/01/tensorboard-tutorial/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/09/01/tensorboard-tutorial/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/09/01/tensorboard-tutorial/" class="leancloud_visitors" data-flag-title="TensorBoard tutorial">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">45(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">1(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <font color='green' size=4>参考链接:</font>

<ol>
<li><a href="https://www.youtube.com/watch?v=eBbEDRsCmv4" target="_blank" rel="noopener">google关于tensorboard的官方视频教程</a></li>
<li><a href="https://github.com/martinwicke/tf-dev-summit-tensorboard-tutorial" target="_blank" rel="noopener">视频教程对应代码</a></li>
<li><a href="https://gaussic.github.io/2017/08/16/tensorflow-tensorboard/" target="_blank" rel="noopener">视频配套博客:TENSORBOARD可视化</a></li>
<li><a href="https://www.tensorflow.org/guide/embedding?hl=zh-CN" target="_blank" rel="noopener">tensorflow官方网站关于tensorboard projector简介</a></li>
<li><a href="https://github.com/tracy-talent/tensorflow-tutorials/blob/master/notebook/guide/TensorBoard2.ipynb" target="_blank" rel="noopener">my tensorboard notebook</a></li>
</ol>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/08/16/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA-SAM-%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/16/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA-SAM-%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" itemprop="url">后缀自动机(SAM)的实现与应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-16T16:50:08+08:00">
                2019-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/ACM-Solution/" itemprop="url" rel="index">
                    <span itemprop="name">ACM Solution</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/16/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA-SAM-%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/08/16/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA-SAM-%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/08/16/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA-SAM-%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" class="leancloud_visitors" data-flag-title="后缀自动机(SAM)的实现与应用">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">5k(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">25(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>后缀自动机(Suffix Automaton,简称SAM)是一个能解决许多字符串相关问题的有力的数据结构。举几个例子</p>
<ul>
<li>一个字符串是否出现在另一个字符串中</li>
<li>一个字符串包含的各不相同的子串数目</li>
<li><p>查询一个字符串在另一个字符串中的出现次数</p>
</li>
<li><p>一个字符串在另一个字符串中第一次出现位置或者所有出现位置</p>
</li>
<li>求两个或多个字符串的最长公共子串</li>
</ul>
<p>上面这几个例子在构建好SAM之后都可以在线性时间内解决</p>
<p>具体的原理可以参考这篇文章<sup><a href="#fn_1" id="reffn_1">1</a></sup>,里面不仅给出了算法流程还给出了算法的正确性证明.</p>
<blockquote id="fn_1">
<sup>1</sup>. <a href="https://oi-wiki.org/string/sam/" target="_blank" rel="noopener">https://oi-wiki.org/string/sam/</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>首先我们假设字符集大小为常数。如果字符集大小不是常数，SAM 的时间复杂度就不是线性的。从一个结点出发的转移存储在支持快速查询和插入的平衡树(map)中。因此如果我们记$\sum$为字符集，$|\sum|$为字符集大小，则算法的渐进时间复杂度为$O(nlog|\sum|)$，空间复杂度为$O(n)$。然而如果字符集足够小，可以不写平衡树，以空间换时间将每个结点的转移存储为长度为$|\sum|$的数组（用于快速查询）和链表（用于快速遍历所有可用关键字）。这样算法的时间复杂度为$O(n)$，空间复杂度为$O(n|\sum|)$。</p>
<p>这两种转移方式我都实现了一遍,并且在SAM基础上解决了前面列举的问题,下面是具体实现的代码</p>
<h3 id="平衡树-map-版本"><a href="#平衡树-map-版本" class="headerlink" title="平衡树(map)版本"></a>平衡树(map)版本</h3><details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后缀自动机，可以在O(n)复杂度内创建一个字符串的SAM</span></span><br><span class="line"><span class="comment">// 最多2*n - 1个状态节点(n &gt;= 2)，最多3*n - 4个转换(n &gt;= 3)</span></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">​    <span class="class"><span class="keyword">struct</span> <span class="title">state</span> &#123;</span></span><br><span class="line">​        <span class="comment">// SAM必须变量</span></span><br><span class="line">​        <span class="keyword">int</span> len, link;  <span class="comment">// len表示状态包含的后缀字符串中的最长串长度,link为后缀链接len(link[v]) + 1 = minlen(v)</span></span><br><span class="line">​        <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用于求子串出现次数的变量</span></span><br><span class="line">        <span class="keyword">int</span> cnt; <span class="comment">// 子串出现次数</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">// firstpos用于求子串第一次出现位置,配合is_clone和inv_link可用于求子串所有出现位置</span></span><br><span class="line">        <span class="keyword">int</span> firstpos;  <span class="comment">// 子串第一次出现位置</span></span><br><span class="line">        <span class="keyword">bool</span> is_clone;  <span class="comment">// 标志节点是否是复制的</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; inv_link; <span class="comment">// 节点的后缀引用列表,该节点对应串是列表内节点的后缀</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">// ml和nl用于求多字符串的最长公共子串</span></span><br><span class="line">        <span class="keyword">int</span> nl;  <span class="comment">// 当前字符串与状态节点对应最长后缀的公共子串长</span></span><br><span class="line">        <span class="keyword">int</span> ml;  <span class="comment">// 所有字符串与状态节点对应最长后缀的公共子串长中的最小长度</span></span><br><span class="line">    &#125;; <span class="comment">// 状态节点，一个状态对应一个endpoint集合</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXLEN = <span class="number">100000</span>;  <span class="comment">// 字符串长度限制</span></span><br><span class="line">    state st[MAXLEN * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> sz, last;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sam_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</span><br><span class="line">            st[i].next.<span class="built_in">clear</span>();</span><br><span class="line">            st[i].inv_link.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        st[<span class="number">0</span>].len = <span class="number">0</span>;</span><br><span class="line">        st[<span class="number">0</span>].link = <span class="number">-1</span>;</span><br><span class="line">        sz = <span class="number">1</span>;</span><br><span class="line">        last = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 向sam中插入字符</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sam_extend</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cur = sz++;</span><br><span class="line">        st[cur].len = st[last].len + <span class="number">1</span>;</span><br><span class="line">        st[cur].ml = st[cur].len;</span><br><span class="line">        st[cur].nl = <span class="number">0</span>;</span><br><span class="line">        st[cur].firstpos = st[cur].len - <span class="number">1</span>;</span><br><span class="line">        st[cur].is_clone = <span class="literal">false</span>;</span><br><span class="line">        st[cur].cnt = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> p = last;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; !st[p].next.count(c)) &#123;</span><br><span class="line">            st[p].next[c] = cur;</span><br><span class="line">            p = st[p].link;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="number">-1</span>) &#123;</span><br><span class="line">            st[cur].link = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> q = st[p].next[c];</span><br><span class="line">            <span class="keyword">if</span> (st[p].len + <span class="number">1</span> == st[q].len) &#123;</span><br><span class="line">                st[cur].link = q;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> clone = sz++;</span><br><span class="line">                st[clone].len = st[p].len + <span class="number">1</span>;</span><br><span class="line">                st[clone].ml = st[clone].len;</span><br><span class="line">                st[clone].nl = <span class="number">0</span>;</span><br><span class="line">                st[clone].is_clone = <span class="literal">true</span>;</span><br><span class="line">                st[clone].firstpos = st[q].firstpos;</span><br><span class="line">                st[clone].cnt = <span class="number">0</span>;</span><br><span class="line">                st[clone].next = st[q].next;</span><br><span class="line">                st[clone].link = st[q].link;</span><br><span class="line">                <span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; st[p].next.count(c) &amp;&amp; st[p].next[c] == q) &#123;</span><br><span class="line">                    st[p].next[c] = clone;</span><br><span class="line">                    p = st[p].link;</span><br><span class="line">                &#125;</span><br><span class="line">                st[q].link = st[cur].link = clone;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        last = cur;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取子串数目</span></span><br><span class="line"><span class="keyword">bool</span> vis[SAM::MAXLEN * <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_substr_num</span><span class="params">(<span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">​    <span class="keyword">int</span> res = (idx == <span class="number">0</span> ? <span class="number">0</span> : SAM::st[idx].len - SAM::st[SAM::st[idx].link].len);</span><br><span class="line">​    <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;::iterator iter = SAM::st[idx].next.<span class="built_in">begin</span>();</span><br><span class="line">​    <span class="keyword">for</span> (; iter != SAM::st[idx].next.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">​        <span class="keyword">if</span> (!vis[iter-&gt;second]) res += get_substr_num(iter-&gt;second);</span><br><span class="line">​    &#125;</span><br><span class="line">​    vis[idx] = <span class="literal">true</span>;</span><br><span class="line">​    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子串查询，判断子串s是否包含在SAM对应的字符串中</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">lookup</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">​    <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">​    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; i++) &#123;</span><br><span class="line">​        <span class="keyword">if</span> (SAM::st[idx].next.count(s[i])) </span><br><span class="line">​            idx = SAM::st[idx].next[s[i]]; </span><br><span class="line">​        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径计数(可用于计算子串数目)</span></span><br><span class="line"><span class="keyword">int</span> d[SAM::MAXLEN * <span class="number">2</span>]; <span class="comment">// d[i]表示从节点i出发的路径数目</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">path_count</span><span class="params">(<span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">​    <span class="comment">// 从根节点出发的路径数目即为子串数目</span></span><br><span class="line">​    d[idx] = <span class="number">0</span>;</span><br><span class="line">​    <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;::iterator iter = SAM::st[idx].next.<span class="built_in">begin</span>();</span><br><span class="line">​    <span class="keyword">for</span> (; iter != SAM::st[idx].next.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">​        d[idx] += <span class="number">1</span> + path_count(iter-&gt;second);</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> d[idx];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找字典序第k大的子串</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">find_kth_substr</span><span class="params">(<span class="keyword">int</span> k, <span class="built_in">string</span> &amp;res, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">​    <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;::iterator iter = SAM::st[idx].next.<span class="built_in">begin</span>();</span><br><span class="line">​    <span class="keyword">for</span> (; iter != SAM::st[idx].next.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">​        <span class="keyword">int</span> t = <span class="number">1</span> + d[iter-&gt;second];</span><br><span class="line">​        <span class="keyword">if</span> (k &gt; t) k -= t;</span><br><span class="line">​        <span class="keyword">else</span> &#123;</span><br><span class="line">​            res += iter-&gt;first;</span><br><span class="line">​            <span class="keyword">if</span> (k &gt; <span class="number">1</span>) find_kth_substr(k - <span class="number">1</span>, res, iter-&gt;second);</span><br><span class="line">​            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询子串出现次数</span></span><br><span class="line"><span class="keyword">int</span> csort[SAM::MAXLEN + <span class="number">1</span>]; <span class="comment">// 用于对len计数排序</span></span><br><span class="line"><span class="keyword">int</span> idsort[<span class="number">2</span> * SAM::MAXLEN];  <span class="comment">// 存储按len排好序的索引id</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_count</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;::iterator iter = SAM::st[idx].next.<span class="built_in">begin</span>();</span><br><span class="line">   <span class="keyword">for</span> (; iter != SAM::st[idx].next.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">​       <span class="keyword">if</span> (iter-&gt;first == s[<span class="number">0</span>]) &#123;</span><br><span class="line">​           <span class="keyword">return</span> !s[<span class="number">1</span>] ? SAM::st[iter-&gt;second].cnt : query_count(s + <span class="number">1</span>, iter-&gt;second);</span><br><span class="line">​       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询子串第一次出现位置,返回对应节点索引号,不存在则返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_firstpos</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">​    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;::iterator iter = SAM::st[idx].next.<span class="built_in">begin</span>();</span><br><span class="line">​    <span class="keyword">for</span> (; iter != SAM::st[idx].next.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">​        <span class="keyword">if</span> (iter-&gt;first == s[<span class="number">0</span>]) &#123;</span><br><span class="line">​            <span class="keyword">return</span> !s[<span class="number">1</span>] ? iter-&gt;second : query_firstpos(s + <span class="number">1</span>, iter-&gt;second);</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询子串所有出现位置</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_allpos</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> plen, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;res)</span> </span>&#123;</span><br><span class="line">​    <span class="keyword">if</span> (!SAM::st[v].is_clone) res.push_back(SAM::st[v].firstpos - plen + <span class="number">1</span>);</span><br><span class="line">​    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; SAM::st[v].inv_link.<span class="built_in">size</span>(); i++) query_allpos(SAM::st[v].inv_link[i], plen, res);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 最长公共子串</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">LCS</span><span class="params">(<span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line">​    <span class="keyword">int</span> v = <span class="number">0</span>, l = <span class="number">0</span>, best = <span class="number">0</span>, bestpos = <span class="number">0</span>;</span><br><span class="line">​    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; t.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">​        <span class="keyword">while</span> (v &amp;&amp; !SAM::st[v].next.count(t[i])) &#123;</span><br><span class="line">​            v = SAM::st[v].link;</span><br><span class="line">​            l = SAM::st[v].len;</span><br><span class="line">​        &#125;</span><br><span class="line">​        <span class="keyword">if</span> (SAM::st[v].next.count(t[i])) &#123;</span><br><span class="line">​            v = SAM::st[v].next[t[i]];</span><br><span class="line">​            l++;</span><br><span class="line">​        &#125;</span><br><span class="line">​        <span class="keyword">if</span> (l &gt; best) &#123;</span><br><span class="line">​            best = l;</span><br><span class="line">​            bestpos = i;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> t.substr(bestpos - best + <span class="number">1</span>, best);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个字符串的最长公共前缀</span></span><br><span class="line"><span class="comment">// 依据SAM的状态节点id在SAM中提取指定长度的子串,存在则返回真</span></span><br><span class="line"><span class="comment">// 并将结果写到lcs中否则返回false</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">get_substr</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> sid, <span class="keyword">size_t</span> len, <span class="built_in">string</span> &amp;lcs)</span> </span>&#123;</span><br><span class="line">​    <span class="keyword">if</span> (idx != <span class="number">0</span> &amp;&amp; idx == sid) <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">​    <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;::iterator iter = SAM::st[idx].next.<span class="built_in">begin</span>();</span><br><span class="line">​    <span class="keyword">for</span> (; iter != SAM::st[idx].next.<span class="built_in">end</span>(); iter++) &#123;</span><br><span class="line">​        <span class="keyword">if</span> (get_substr(iter-&gt;second, sid, len, lcs)) &#123;</span><br><span class="line">​            lcs += iter-&gt;first;</span><br><span class="line">​            <span class="keyword">if</span> (idx != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">​            <span class="keyword">else</span> &#123;</span><br><span class="line">​                <span class="keyword">if</span> (lcs.<span class="built_in">size</span>() == len) &#123;</span><br><span class="line">​                    reverse(lcs.<span class="built_in">begin</span>(), lcs.<span class="built_in">end</span>());</span><br><span class="line">​                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">​                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">​                    lcs.<span class="built_in">clear</span>();    </span><br><span class="line">​                &#125;</span><br><span class="line">​            &#125;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间复杂度为各字符串长总和</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS_Mul</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">string</span> &amp;lcs)</span> </span>&#123;</span><br><span class="line">​    <span class="keyword">int</span> ans = <span class="number">0</span>, nid = <span class="number">0</span>;</span><br><span class="line">​    <span class="built_in">string</span> s;</span><br><span class="line">​    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">​        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">​        <span class="keyword">int</span> tnl = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line">​        <span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; s.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">​            <span class="keyword">if</span> (SAM::st[p].next.count(s[j])) &#123;</span><br><span class="line">​                tnl++;</span><br><span class="line">​                p = SAM::st[p].next[s[j]];</span><br><span class="line">​            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">​                <span class="keyword">while</span> (p &amp;&amp; !SAM::st[p].next.count(s[j])) p = SAM::st[p].link;</span><br><span class="line">​                <span class="keyword">if</span> (SAM::st[p].next.count(s[j])) &#123;</span><br><span class="line">​                    tnl = SAM::st[p].len + <span class="number">1</span>;</span><br><span class="line">​                    p = SAM::st[p].next[s[j]];</span><br><span class="line">​                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">​                    tnl = <span class="number">0</span>;</span><br><span class="line">​                &#125;</span><br><span class="line">​            &#125;</span><br><span class="line">​            SAM::st[p].nl = <span class="built_in">max</span>(SAM::st[p].nl, tnl);</span><br><span class="line">​        &#125;</span><br><span class="line">​        <span class="keyword">for</span> (<span class="keyword">int</span> j = SAM::sz - <span class="number">1</span>; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">​            p = idsort[j];</span><br><span class="line">​            <span class="keyword">if</span> (SAM::st[p].nl &lt; SAM::st[p].ml) SAM::st[p].ml = SAM::st[p].nl;</span><br><span class="line">​            <span class="keyword">if</span> (SAM::st[p].link &amp;&amp; SAM::st[SAM::st[p].link].nl &lt; SAM::st[p].nl)</span><br><span class="line">​                SAM::st[SAM::st[p].link].nl = SAM::st[p].nl;</span><br><span class="line">​            SAM::st[p].nl = <span class="number">0</span>;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) &#123;</span><br><span class="line">​        <span class="keyword">if</span> (SAM::st[i].ml &gt; ans) &#123;</span><br><span class="line">​            ans = SAM::st[i].ml;</span><br><span class="line">​            nid = i;</span><br><span class="line">​        &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">​    get_substr(<span class="number">0</span>, nid, ans, lcs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> instr[SAM::MAXLEN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">​    <span class="built_in">cin</span> &gt;&gt; instr;</span><br><span class="line">​    SAM::sam_init();</span><br><span class="line">​    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; instr[i]; i++) SAM::sam_extend(instr[i]);</span><br><span class="line">​    <span class="built_in">cout</span> &lt;&lt; <span class="string">"SAM节点数: "</span> &lt;&lt; SAM::sz &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// SAM节点数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取子串总数</span></span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="literal">false</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; get_substr_num(<span class="number">0</span>) &lt;&lt; <span class="string">" "</span> &lt;&lt; path_count(<span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询串s是否在母串中</span></span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">if</span> (lookup(s)) <span class="built_in">cout</span> &lt;&lt; <span class="string">"exists!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"not exists!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找字典序第k大的子串</span></span><br><span class="line">    <span class="built_in">string</span> substr_k = <span class="string">""</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询第k大子串:"</span>;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; k;</span><br><span class="line">    <span class="keyword">if</span> (find_kth_substr(k, substr_k, <span class="number">0</span>))</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"第"</span> &lt;&lt; k &lt;&lt; <span class="string">"大子串: "</span> &lt;&lt; substr_k &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"不存在,"</span> &lt;&lt; k &lt;&lt; <span class="string">"已超过"</span> &lt;&lt; instr &lt;&lt; <span class="string">"子串总数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询子串出现次数</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串出现次数: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="comment">// 对len计数排序</span></span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(csort, <span class="number">0</span>, <span class="keyword">sizeof</span>(csort));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) &#123;</span><br><span class="line">        csort[SAM::st[i].len]++;</span><br><span class="line">        m = <span class="built_in">max</span>(m, SAM::st[i].len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= m; i++) csort[i] += csort[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) idsort[csort[SAM::st[i].len]--] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = SAM::sz - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        SAM::st[SAM::st[idsort[i]].link].cnt += SAM::st[idsort[i]].cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"子串数目: "</span> &lt;&lt; query_count(s, <span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询子串第一次出现位置,不存在则返回-1,否则返回节点索引对应到第一次出现结束位置</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串第一次出现位置: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">int</span> fid = query_firstpos(s, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fid == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"子串不存在!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; SAM::st[fid].firstpos - <span class="keyword">int</span>(<span class="built_in">strlen</span>(s)) + <span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询子串的所有出现位置(依赖于子串第一次出现节点)</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串所有出现位置: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    fid = query_firstpos(s, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"子串不存在!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) SAM::st[SAM::st[i].link].inv_link.push_back(i);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; occur_pos; <span class="comment">// 所有出现的起始位置存放在occur_pos中</span></span><br><span class="line">        query_allpos(fid, <span class="built_in">strlen</span>(s), occur_pos);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; occur_pos.<span class="built_in">size</span>(); i++) <span class="built_in">cout</span> &lt;&lt; occur_pos[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 两个字符串的最长公共子串</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"两个字符串的最长公共子串: "</span>;</span><br><span class="line">    <span class="built_in">string</span> s1;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s1;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; LCS(s1) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多个字符串的最长公共子串</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"多个字符串的最长公共子串: "</span>;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="comment">// 对len计数排序</span></span><br><span class="line">    <span class="keyword">int</span> lens = <span class="number">0</span>; <span class="comment">// len类别数</span></span><br><span class="line">    <span class="built_in">memset</span>(csort, <span class="number">0</span>, <span class="keyword">sizeof</span>(csort));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) &#123;</span><br><span class="line">        csort[SAM::st[i].len]++;</span><br><span class="line">        lens = <span class="built_in">max</span>(lens, SAM::st[i].len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= lens; i++) csort[i] += csort[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) idsort[csort[SAM::st[i].len]--] = i;</span><br><span class="line">    <span class="built_in">string</span> lcs;</span><br><span class="line">    LCS_Mul(n, lcs);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"多个子串的最长公共子串为"</span> &lt;&lt; lcs &lt;&lt; <span class="string">", 长度"</span> &lt;&lt; lcs.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>


<h3 id="数组-array-版本"><a href="#数组-array-版本" class="headerlink" title="数组(array)版本"></a>数组(array)版本</h3><details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后缀自动机，可以在O(n)复杂度内创建一个字符串的SAM</span></span><br><span class="line"><span class="comment">// 最多2*n - 1个状态节点(n &gt;= 2)，最多3*n - 4个转换(n &gt;= 3)</span></span><br><span class="line"><span class="keyword">namespace</span> SAM &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span> &#123;</span></span><br><span class="line">        <span class="comment">// SAM必须变量</span></span><br><span class="line">        <span class="keyword">int</span> len, link;  <span class="comment">// len表示状态包含的后缀字符串中的最长串长度,link为后缀链接len(link[v]) + 1 = minlen(v)</span></span><br><span class="line">        <span class="keyword">int</span> trans[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用于求子串出现次数的变量</span></span><br><span class="line">        <span class="keyword">int</span> cnt; <span class="comment">// 子串出现次数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// firstpos用于求子串第一次出现位置,配合is_clone和inv_link可用于求子串所有出现位置</span></span><br><span class="line">        <span class="keyword">int</span> firstpos;  <span class="comment">// 子串第一次出现位置</span></span><br><span class="line">        <span class="keyword">bool</span> is_clone;  <span class="comment">// 标志节点是否是复制的</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; inv_link; <span class="comment">// 节点的后缀引用列表,该节点对应串是列表内节点的后缀</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ml和nl用于求多字符串的最长公共子串</span></span><br><span class="line">        <span class="keyword">int</span> nl;  <span class="comment">// 当前字符串与状态节点对应最长后缀的公共子串长</span></span><br><span class="line">        <span class="keyword">int</span> ml;  <span class="comment">// 所有字符串与状态节点对应最长后缀的公共子串长中的最小长度</span></span><br><span class="line">    &#125;; <span class="comment">// 状态节点，一个状态对应一个endpoint集合</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXLEN = <span class="number">100000</span>;  <span class="comment">// 字符串长度限制</span></span><br><span class="line">    state st[MAXLEN * <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">char</span> alpha[<span class="number">26</span>]; <span class="comment">// 小写字母表,限制输入字符串仅含小写字母</span></span><br><span class="line">    <span class="keyword">int</span> sz, last;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sam_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</span><br><span class="line">            <span class="built_in">memset</span>(st[i].trans, <span class="number">0</span> , <span class="keyword">sizeof</span>(st[i].trans));</span><br><span class="line">            st[i].inv_link.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">            alpha[i] = i + <span class="string">'a'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        st[<span class="number">0</span>].len = <span class="number">0</span>;</span><br><span class="line">        st[<span class="number">0</span>].link = <span class="number">-1</span>;</span><br><span class="line">        sz = <span class="number">1</span>;</span><br><span class="line">        last = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向sam中插入字符</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sam_extend</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c = ch - <span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">int</span> cur = sz++;</span><br><span class="line">        st[cur].len = st[last].len + <span class="number">1</span>;</span><br><span class="line">        st[cur].ml = st[cur].len;</span><br><span class="line">        st[cur].nl = <span class="number">0</span>;</span><br><span class="line">        st[cur].firstpos = st[cur].len - <span class="number">1</span>;</span><br><span class="line">        st[cur].is_clone = <span class="literal">false</span>;</span><br><span class="line">        st[cur].cnt = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> p = last;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; !st[p].trans[c]) &#123;</span><br><span class="line">            st[p].trans[c] = cur;</span><br><span class="line">            p = st[p].link;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="number">-1</span>) &#123;</span><br><span class="line">            st[cur].link = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> q = st[p].trans[c];</span><br><span class="line">            <span class="keyword">if</span> (st[p].len + <span class="number">1</span> == st[q].len) &#123;</span><br><span class="line">                st[cur].link = q;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> clone = sz++;</span><br><span class="line">                st[clone].len = st[p].len + <span class="number">1</span>;</span><br><span class="line">                st[clone].ml = st[clone].len;</span><br><span class="line">                st[clone].nl = <span class="number">0</span>;</span><br><span class="line">                st[clone].is_clone = <span class="literal">true</span>;</span><br><span class="line">                st[clone].firstpos = st[q].firstpos;</span><br><span class="line">                st[clone].cnt = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">memcpy</span>(st[clone].trans, st[q].trans, <span class="keyword">sizeof</span>(st[q].trans));</span><br><span class="line">                st[clone].link = st[q].link;</span><br><span class="line">                <span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; st[p].trans[c] == q) &#123;</span><br><span class="line">                    st[p].trans[c] = clone;</span><br><span class="line">                    p = st[p].link;</span><br><span class="line">                &#125;</span><br><span class="line">                st[q].link = st[cur].link = clone;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        last = cur;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取子串数目</span></span><br><span class="line"><span class="keyword">bool</span> vis[SAM::MAXLEN * <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_substr_num</span><span class="params">(<span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = (idx == <span class="number">0</span> ? <span class="number">0</span> : SAM::st[idx].len - SAM::st[SAM::st[idx].link].len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!SAM::st[idx].trans[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (!vis[SAM::st[idx].trans[i]]) res += get_substr_num(SAM::st[idx].trans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    vis[idx] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子串查询，判断子串s是否包含在SAM对应的字符串中</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">lookup</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (SAM::st[idx].trans[s[i] - <span class="string">'a'</span>]) </span><br><span class="line">            idx = SAM::st[idx].trans[s[i] - <span class="string">'a'</span>]; </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径计数(可用于计算子串数目)</span></span><br><span class="line"><span class="keyword">int</span> d[SAM::MAXLEN * <span class="number">2</span>]; <span class="comment">// d[i]表示从节点i出发的路径数目</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">path_count</span><span class="params">(<span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 从根节点出发的路径数目即为子串数目</span></span><br><span class="line">    d[idx] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (SAM::st[idx].trans[i])</span><br><span class="line">            d[idx] += <span class="number">1</span> + path_count(SAM::st[idx].trans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[idx];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找字典序第k大的子串</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">find_kth_substr</span><span class="params">(<span class="keyword">int</span> k, <span class="built_in">string</span> &amp;res, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!SAM::st[idx].trans[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> t = <span class="number">1</span> + d[SAM::st[idx].trans[i]];</span><br><span class="line">        <span class="keyword">if</span> (k &gt; t) k -= t;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res += SAM::alpha[i];</span><br><span class="line">            <span class="keyword">if</span> (k &gt; <span class="number">1</span>) find_kth_substr(k - <span class="number">1</span>, res, SAM::st[idx].trans[i]);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询子串出现次数</span></span><br><span class="line"><span class="keyword">int</span> csort[SAM::MAXLEN + <span class="number">1</span>]; <span class="comment">// 用于对len计数排序</span></span><br><span class="line"><span class="keyword">int</span> idsort[<span class="number">2</span> * SAM::MAXLEN];  <span class="comment">// 存储按len排好序的索引id</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_count</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">       <span class="keyword">if</span> (!SAM::st[idx].trans[i]) <span class="keyword">continue</span>;</span><br><span class="line">       <span class="keyword">if</span> (SAM::alpha[i] == s[<span class="number">0</span>]) &#123;</span><br><span class="line">           <span class="keyword">return</span> !s[<span class="number">1</span>] ? SAM::st[SAM::st[idx].trans[i]].cnt : query_count(s + <span class="number">1</span>, SAM::st[idx].trans[i]);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询子串第一次出现位置,返回对应节点索引号,不存在则返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_firstpos</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!SAM::st[idx].trans[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (SAM::alpha[i] == s[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> !s[<span class="number">1</span>] ? SAM::st[idx].trans[i] : query_firstpos(s + <span class="number">1</span>, SAM::st[idx].trans[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询子串所有出现位置</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_allpos</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> plen, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;res)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!SAM::st[v].is_clone) res.push_back(SAM::st[v].firstpos - plen + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; SAM::st[v].inv_link.<span class="built_in">size</span>(); i++) query_allpos(SAM::st[v].inv_link[i], plen, res);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 最长公共子串</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">LCS</span><span class="params">(<span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v = <span class="number">0</span>, l = <span class="number">0</span>, best = <span class="number">0</span>, bestpos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; t.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (v &amp;&amp; !SAM::st[v].trans[t[i] - <span class="string">'a'</span>]) &#123;</span><br><span class="line">            v = SAM::st[v].link;</span><br><span class="line">            l = SAM::st[v].len;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (SAM::st[v].trans[t[i] - <span class="string">'a'</span>]) &#123;</span><br><span class="line">            v = SAM::st[v].trans[t[i] - <span class="string">'a'</span>];</span><br><span class="line">            l++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; best) &#123;</span><br><span class="line">            best = l;</span><br><span class="line">            bestpos = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t.substr(bestpos - best + <span class="number">1</span>, best);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个字符串的最长公共前缀</span></span><br><span class="line"><span class="comment">// 依据SAM的状态节点id在SAM中提取指定长度的子串,存在则返回真</span></span><br><span class="line"><span class="comment">// 并将结果写到lcs中否则返回false</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">get_substr</span><span class="params">(<span class="keyword">int</span> idx, <span class="keyword">int</span> sid, <span class="keyword">size_t</span> len, <span class="built_in">string</span> &amp;lcs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (idx != <span class="number">0</span> &amp;&amp; idx == sid) <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!SAM::st[idx].trans[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (get_substr(SAM::st[idx].trans[i], sid, len, lcs)) &#123;</span><br><span class="line">            lcs += SAM::alpha[i];</span><br><span class="line">            <span class="keyword">if</span> (idx != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (lcs.<span class="built_in">size</span>() == len) &#123;</span><br><span class="line">                    reverse(lcs.<span class="built_in">begin</span>(), lcs.<span class="built_in">end</span>());</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    lcs.<span class="built_in">clear</span>();    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间复杂度为各字符串长总和</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS_Mul</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">string</span> &amp;lcs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>, nid = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">        <span class="keyword">int</span> tnl = <span class="number">0</span>, p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; s.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (SAM::st[p].trans[s[j] - <span class="string">'a'</span>]) &#123;</span><br><span class="line">                tnl++;</span><br><span class="line">                p = SAM::st[p].trans[s[j] - <span class="string">'a'</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; !SAM::st[p].trans[s[j] - <span class="string">'a'</span>]) p = SAM::st[p].link;</span><br><span class="line">                <span class="keyword">if</span> (SAM::st[p].trans[s[j] - <span class="string">'a'</span>]) &#123;</span><br><span class="line">                    tnl = SAM::st[p].len + <span class="number">1</span>;</span><br><span class="line">                    p = SAM::st[p].trans[s[j] - <span class="string">'a'</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    tnl = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            SAM::st[p].nl = <span class="built_in">max</span>(SAM::st[p].nl, tnl);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = SAM::sz - <span class="number">1</span>; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            p = idsort[j];</span><br><span class="line">            <span class="keyword">if</span> (SAM::st[p].nl &lt; SAM::st[p].ml) SAM::st[p].ml = SAM::st[p].nl;</span><br><span class="line">            <span class="keyword">if</span> (SAM::st[p].link &amp;&amp; SAM::st[SAM::st[p].link].nl &lt; SAM::st[p].nl)</span><br><span class="line">                SAM::st[SAM::st[p].link].nl = SAM::st[p].nl;</span><br><span class="line">            SAM::st[p].nl = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (SAM::st[i].ml &gt; ans) &#123;</span><br><span class="line">            ans = SAM::st[i].ml;</span><br><span class="line">            nid = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    get_substr(<span class="number">0</span>, nid, ans, lcs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> instr[SAM::MAXLEN];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; instr;  <span class="comment">// 仅限小写字母</span></span><br><span class="line">    SAM::sam_init();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; instr[i]; i++) SAM::sam_extend(instr[i]);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"SAM节点数: "</span> &lt;&lt; SAM::sz &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">// SAM节点数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取子串总数</span></span><br><span class="line">    <span class="built_in">memset</span>(vis, <span class="literal">false</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; get_substr_num(<span class="number">0</span>) &lt;&lt; <span class="string">" "</span> &lt;&lt; path_count(<span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询串s是否在母串中</span></span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">if</span> (lookup(s)) <span class="built_in">cout</span> &lt;&lt; <span class="string">"exists!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"not exists!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查找字典序第k大的子串</span></span><br><span class="line">    <span class="built_in">string</span> substr_k = <span class="string">""</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询第k大子串:"</span>;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; k;</span><br><span class="line">    <span class="keyword">if</span> (find_kth_substr(k, substr_k, <span class="number">0</span>))</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"第"</span> &lt;&lt; k &lt;&lt; <span class="string">"大子串: "</span> &lt;&lt; substr_k &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"不存在,"</span> &lt;&lt; k &lt;&lt; <span class="string">"已超过"</span> &lt;&lt; instr &lt;&lt; <span class="string">"子串总数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询子串出现次数</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串出现次数: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="comment">// 对len计数排序</span></span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(csort, <span class="number">0</span>, <span class="keyword">sizeof</span>(csort));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) &#123;</span><br><span class="line">        csort[SAM::st[i].len]++;</span><br><span class="line">        m = <span class="built_in">max</span>(m, SAM::st[i].len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= m; i++) csort[i] += csort[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) idsort[csort[SAM::st[i].len]--] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = SAM::sz - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        SAM::st[SAM::st[idsort[i]].link].cnt += SAM::st[idsort[i]].cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"子串数目: "</span> &lt;&lt; query_count(s, <span class="number">0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询子串第一次出现位置,不存在则返回-1,否则返回节点索引对应到第一次出现结束位置</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串第一次出现位置: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">int</span> fid = query_firstpos(s, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fid == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"子串不存在!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; SAM::st[fid].firstpos - <span class="keyword">int</span>(<span class="built_in">strlen</span>(s)) + <span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询子串的所有出现位置(依赖于子串第一次出现节点)</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"查询子串所有出现位置: "</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    fid = query_firstpos(s, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (fid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"子串不存在!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) SAM::st[SAM::st[i].link].inv_link.push_back(i);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; occur_pos; <span class="comment">// 所有出现的起始位置存放在occur_pos中</span></span><br><span class="line">        query_allpos(fid, <span class="built_in">strlen</span>(s), occur_pos);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; occur_pos.<span class="built_in">size</span>(); i++) <span class="built_in">cout</span> &lt;&lt; occur_pos[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 两个字符串的最长公共子串</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"两个字符串的最长公共子串: "</span>;</span><br><span class="line">    <span class="built_in">string</span> s1;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s1;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; LCS(s1) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多个字符串的最长公共子串</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"多个字符串的最长公共子串: "</span>;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="comment">// 对len计数排序</span></span><br><span class="line">    <span class="keyword">int</span> lens = <span class="number">0</span>; <span class="comment">// len类别数</span></span><br><span class="line">    <span class="built_in">memset</span>(csort, <span class="number">0</span>, <span class="keyword">sizeof</span>(csort));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) &#123;</span><br><span class="line">        csort[SAM::st[i].len]++;</span><br><span class="line">        lens = <span class="built_in">max</span>(lens, SAM::st[i].len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= lens; i++) csort[i] += csort[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SAM::sz; i++) idsort[csort[SAM::st[i].len]--] = i;</span><br><span class="line">    <span class="built_in">string</span> lcs;</span><br><span class="line">    LCS_Mul(n, lcs);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"多个子串的最长公共子串为"</span> &lt;&lt; lcs &lt;&lt; <span class="string">", 长度"</span> &lt;&lt; lcs.<span class="built_in">size</span>() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>


          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/08/14/Word2Vec%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/Word2Vec%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" itemprop="url">Word2Vec原理详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-14T19:15:20+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Research/" itemprop="url" rel="index">
                    <span itemprop="name">Research</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Research/Paper/" itemprop="url" rel="index">
                    <span itemprop="name">Paper</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/14/Word2Vec%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/08/14/Word2Vec%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/08/14/Word2Vec%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" class="leancloud_visitors" data-flag-title="Word2Vec原理详解">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">1.3k(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">6(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <font color='red' size=5>paper</font>

<ul>
<li><p><a href="https://arxiv.org/pdf/1301.3781.pdf" target="_blank" rel="noopener">Efficient Estimation of Word Representations in<br>Vector Space</a></p>
</li>
<li><p><a href="http://papers.nips.cc/paper/5021-distributed-representations-of-words-and-phrases-and-their-compositionality.pdf" target="_blank" rel="noopener">Distributed Representations of Words and Phrases<br>and their Compositionality</a></p>
</li>
</ul>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Word2Vec分为CBOW模型(Continuous Bag-of-Words Model)和Skip-gram(Continuous Skip-gram Model)模型,如下图所示</p>
<div align="center">
    <img src="/images/paper/word2vec1.png">
</div>

<p>当训练文本集规模较小时适合使用CBOW模型，当训练文本集规模较大时适合使用Skip-gram模型</p>
<h3 id="训练方法"><a href="#训练方法" class="headerlink" title="训练方法"></a>训练方法</h3><h4 id="Hierarchical-Softmax"><a href="#Hierarchical-Softmax" class="headerlink" title="Hierarchical Softmax"></a>Hierarchical Softmax</h4><p>方法一：基于Huffman树的Hierarchical Softmax</p>
<h4 id="Negative-Sampling"><a href="#Negative-Sampling" class="headerlink" title="Negative Sampling"></a>Negative Sampling</h4><p>方法二：作者Mikolov提出的Negative Sampling(NEG)，该方法是Noise Contrastive Estimation(NCE)的一个简化版本</p>
<h5 id="CBOW模型"><a href="#CBOW模型" class="headerlink" title="CBOW模型"></a>CBOW模型</h5><p>在CBOW模型中，已知词$w$的上下文$Context(w)$，需要预测$w$，因此对于给定的$Context(w)$，词$w$就是一个正样本，其它词就是负样本了。假定现在已经选好了一个关于$w$的负样本子集$NEG(w) \ne \emptyset$，且对$\forall\  \widetilde{w} \in \mathcal{D}$，定义</p>
<script type="math/tex; mode=display">
  L^{w}(\widetilde{w})=\begin{cases}
  1,& {\widetilde{w}}=w; \\
  0,& {\widetilde{w}} \ne w;
  \end{cases}\tag{1.1}</script><p>令$\sigma(x)=\frac{1}{1+\mathrm{e}^{x}}$，语料库$C$，概率生成函数如下</p>
<script type="math/tex; mode=display">
\begin{align}
    G&=\prod_{w \in C}{g(\mathcal{w})} \\
    &=\prod_{w \in C}\prod_{u \in \{w\} \cup NEG(w)}{p(u|Context(w))} 
    \end{align}\tag{1.2}</script><p>其中</p>
<script type="math/tex; mode=display">
  p(u|Context(w))=\begin{cases}
    \sigma({x_{w}^{T}\theta^{u})},& L^{w}(u)=1\\
    1-\sigma(x_{w}^{T}\theta^{u}), & L^{w}(u)=0
    \end{cases}\tag{1.3}</script><p>可将$p(u|Context(w))$写成整体表达式如下</p>
<script type="math/tex; mode=display">
p(u|Context(w))=[\sigma({x_{w}^{T}\theta^{u}})]^{L^{w}(u)} \cdot [1-\sigma(x_{w}^{T}\theta^{u})]^{1-L^{w}(u)}\tag{1.4}</script><p>从而$g(w)$可简写为</p>
<script type="math/tex; mode=display">
g(w)=\sigma({x_{w}^{T}\theta^{w}})\prod_{u \in NEG(w)}{[1 - \sigma({x_{w}^{T}\theta^{u}})]}\tag{1.5}</script><p>最终的目标函数对G取对数求最大似然。从形式上看，最大化$g(w)$相当于最大化<script type="math/tex">\sigma({x_{w}^{T}\theta^{w}})</script>，同时最小化所有的<script type="math/tex">\sigma({x_{w}^{T}\theta^{u}}),u \in NEG(w)</script>，使得增大正样本概率的同时降低负样本的概率，这正是我们所希望看到的结果</p>
<script type="math/tex; mode=display">
\begin{align}
    \mathcal{L}&=\log{G}=\log\prod_{w \in \mathcal{C}}g(w)=\sum_{w \in \mathcal{C}}\log{g(w)} \\
    &=\sum_{w \in \mathcal{C}}\sum_{u \in \{w\} \cup NEG(w)}\{L^{w}(u) \cdot \log[\sigma(x_{w}^{T}\theta^{u})]+[1-L^{w}(u)] \cdot \log[1-\sigma({x_{w}^{T}\theta^{u}})]\}
\end{align}\tag{1.6}</script><p>为方便梯度推导，将(1.6)式花括号中的内容简记为$\mathcal{L}(w,u)$，即</p>
<script type="math/tex; mode=display">
\mathcal{L}(w,u)=L^{w}(u) \cdot \log[\sigma({x_{w}^{T}\theta^{u}})]+[1-L^{w}(u)] \cdot \log{[1-\sigma({x_{w}^{T}\theta^{u}})]} \tag{1.7}</script><p>利用梯度上升法对$\mathcal{L}$进行优化求最大值，$\mathcal{L}(w,u)$分别对$x_{w}和\theta^{u}$求偏导</p>
<script type="math/tex; mode=display">
\begin{align}
  \frac{\partial\mathcal{L}(w,u)}{\partial\theta^{u}}&=\frac{\partial}{\partial\theta^{u}}\{L^{w}(u) \cdot \log[\sigma(x_{w}^{T}\theta^{u})]+[1-L^{w}(u)] \cdot \log[1-\sigma({x_{w}^{T}\theta^{u}})]\}\\
  &=L^{w}(u)[1-\sigma(x_{w}^{T}\theta^{u}]x_{w}-[1-L^{w}(u)]\sigma(x_{w}^{T}\theta^{u})x_{w}\\
  &=\{L^{w}(u)[1-\sigma(x_{w}^{T}\theta^{u}]-[1-L^{w}(u)]\sigma(x_{w}^{T}\theta^{u})\}x_{w}\\
  &=[L^{w}(u)-\sigma(x_{w}^{T}\theta^{u})]x_{w}
\end{align}\tag{1.8}</script><p>于是$\theta^{u}$的更新公式可写成</p>
<script type="math/tex; mode=display">
  \theta^{u}=\theta^{u}+\eta[L^{w}(u)-\sigma(x_{w}^{T}\theta^{u})]x_{w} \tag{1.9}</script><p>接下来考虑$\mathcal{L}(w,u)$对<script type="math/tex">x_{w}</script>的偏导，由于式(1.7)中<script type="math/tex">x_{w}</script>和<script type="math/tex">\theta^{u}</script>的对称性可得</p>
<script type="math/tex; mode=display">
  \frac{\partial\mathcal{L}(w,u)}{\partial{x_{w}}}=[L^{w}(u)-\sigma(x_{w}^{T}\theta^{u})]\theta^{u} \tag{1.10}</script><p>于是，利用式(1.10)的结果可得$v(\widetilde{w}),\widetilde{w} \in Context(w)$的更新公式为</p>
<script type="math/tex; mode=display">
v(\widetilde{w})=v(\widetilde{w}) + \eta\sum_{u \in \{w\} \cup NEG(w)}\frac{\partial\mathcal{L}(w,u)}{\partial{x_{w}}} \tag{1.11}</script><p>伪代码如下</p>
<div align="center">
    <img src="/images/paper/word2vec2.png">
</div>



<h5 id="Skip-gram模型"><a href="#Skip-gram模型" class="headerlink" title="Skip-gram模型"></a>Skip-gram模型</h5><p>结合SKip-gram和CBOW模型的区别，将优化目标函数由原来的$G=\prod_{w \in C}g(w)$改写为</p>
<script type="math/tex; mode=display">
G=\prod_{w \in C}\prod_{u \in Context(w)}g(u) \tag{2.1}</script><p>这里，$\prod_{u \in Context(w)}g(u)$表示对于一个给定的样本$(w,Context(w))$，我们希望最大化的量，$g(u)$类似于上一节$g(w)$，定义为</p>
<script type="math/tex; mode=display">
g(u)=\prod_{z \in \{u\} \cup NEG(u)}p(z|w) \tag{2.2}</script><p>其中$NEG(u)$表示处理词u时生成的负样本子集，条件概率</p>
<script type="math/tex; mode=display">
p(z|w)=\begin{cases}
\sigma(v(w)^T\theta^z),& L^{u}(z)=1\\
1-\sigma(v(w)^T\theta^z),& L^{u}(z)=0
\end{cases}\tag{2.3}</script><p>(2.3)式写成整体表达式为</p>
<script type="math/tex; mode=display">
p(z|w)=[\sigma(v(w)^T\theta^{z}]^{L^{u}(z)} \cdot [1-\sigma(v(w)^{T}\theta^{z})]^{1-L^{u}(z)} \tag{2.4}</script><p>同样，我们取G的对数，最终的目标函数为</p>
<script type="math/tex; mode=display">
\begin{align}
\mathcal{L}=\log{G}&=log\prod_{w \in C}\prod_{u \in Context(w)}\prod_{z \in \{u\} \cup NEG(u)}p(z|w)\\
&=\sum_{w \in C}\sum_{u \in Context(w)}\sum_{z \in \{u\} \cup NEG(u)}\log{p(z|w)}\\
&=\sum_{w \in C}\sum_{u \in Context(w)}\sum_{z \in \{u\} \cup NEG(u)}\{L^{u}(z) \cdot \log{[\sigma(v(w)^T\theta^{z})]} + [1-L^{u}(z)]\log{[1-\sigma(v(w)^{T}\theta^z)]}\}
\end{align}\tag{2.5}</script><p>与CBOW模型一样利用梯度上升法对$\mathcal{L}$进行优化求最大值，将式(2.5)中花括号中的内容简记为$\mathcal{L}(w,u,z)$，然后将$\mathcal{L}(w,u,z)$分别对$v(w)$和$\theta^{z}$求偏导，具体求解过程省略，可参考文末链接参考1中的5.2节</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol>
<li><a href="https://www.cnblogs.com/peghoty/p/3857839.html" target="_blank" rel="noopener">* word2vec 中的数学原理详解</a></li>
<li><a href="https://blog.csdn.net/Layumi1993/article/details/72866235" target="_blank" rel="noopener">Word2Vec教程 - Skip-Gram模型</a></li>
<li><a href="https://blog.csdn.net/Layumi1993/article/details/72868399" target="_blank" rel="noopener">Word2Vec教程（2）- Negative Sampling</a></li>
<li><a href="https://www.bilibili.com/video/av6475775" target="_blank" rel="noopener">Hierarchical Softmax(视频)</a></li>
<li><a href="http://www.jmlr.org/papers/volume13/gutmann12a/gutmann12a.pdf" target="_blank" rel="noopener">Noise Contrastive Estimation(paper)</a></li>
</ol>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/08/14/%E4%B8%89%E8%89%B2%E6%97%97%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/%E4%B8%89%E8%89%B2%E6%97%97%E9%97%AE%E9%A2%98/" itemprop="url">三色旗问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-14T15:51:57+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/14/%E4%B8%89%E8%89%B2%E6%97%97%E9%97%AE%E9%A2%98/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/08/14/%E4%B8%89%E8%89%B2%E6%97%97%E9%97%AE%E9%A2%98/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/08/14/%E4%B8%89%E8%89%B2%E6%97%97%E9%97%AE%E9%A2%98/" class="leancloud_visitors" data-flag-title="三色旗问题">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">411(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">1(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>假设有一条绳子，上面有红、白、蓝三种颜色的旗子，起初绳子上的旗子的颜色并没有顺序，你希望将之分类并排列为蓝、白、红的顺序，要如何移动次数最少，注意你只能在绳子上进行这个动作，并且一次只能调换两个旗子。</p>
<h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><p>快排的思想，分别设三个标记wflag，rflag，bflag，初始bflag和wflag置首，rflag置末，然后分以下几个步骤解决：</p>
<ol>
<li>rflag向左移动到第一个非红色旗处停下，bflag向前移动到第一个非蓝色旗停下，wflag向前移动超越bflag并在非白色旗处停下</li>
<li>wflag处如果为红旗则与rflag处的旗交换位置，如果为蓝旗则与bflag处的旗交换位置，交换位置后移动更新三个标志位的位置</li>
<li>重复1~2步直到wflag &gt; rflag</li>
</ol>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(<span class="meta-string">"O2"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//char color[] = &#123;'r','w','b','w','w','b','r','b','w','r','\0'&#125;;</span></span><br><span class="line"><span class="keyword">char</span> color[] = &#123;<span class="string">'r'</span>,<span class="string">'r'</span>,<span class="string">'r'</span>,<span class="string">'r'</span>,<span class="string">'r'</span>,<span class="string">'b'</span>, <span class="string">'\0'</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> n = <span class="built_in">strlen</span>(color);</span><br><span class="line"><span class="keyword">int</span> wflag = <span class="number">0</span>, bflag = <span class="number">0</span>, rflag = n - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (bflag &lt; n &amp;&amp; color[bflag] == <span class="string">'b'</span>) bflag++;</span><br><span class="line">    <span class="keyword">while</span> (wflag &lt; n &amp;&amp; (wflag &lt; bflag || color[wflag] == <span class="string">'w'</span>)) wflag++;</span><br><span class="line">    <span class="keyword">while</span> (rflag &gt;= <span class="number">0</span> &amp;&amp; color[rflag] == <span class="string">'r'</span>) rflag--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; color &lt;&lt; <span class="string">" "</span> &lt;&lt; n &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">move</span>();</span><br><span class="line">    <span class="keyword">while</span> (wflag &lt; n &amp;&amp; wflag &lt;= rflag) &#123;</span><br><span class="line">    	<span class="keyword">if</span> (color[wflag] == <span class="string">'r'</span>) &#123;</span><br><span class="line">    		swap(color[wflag], color[rflag]);</span><br><span class="line">    		res++;</span><br><span class="line">    	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (color[wflag] == <span class="string">'b'</span>) &#123;</span><br><span class="line">    		swap(color[wflag], color[bflag]);</span><br><span class="line">    		res++;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="built_in">move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; color &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"至少交换 "</span> &lt;&lt; res &lt;&lt; <span class="string">" 次"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/08/09/%E7%9A%AE%E5%B0%94%E9%80%8A%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%B0%8F%E4%BA%8E1%E7%9A%84%E8%AF%81%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/09/%E7%9A%AE%E5%B0%94%E9%80%8A%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%B0%8F%E4%BA%8E1%E7%9A%84%E8%AF%81%E6%98%8E/" itemprop="url">皮尔逊相关系数绝对值小于1的证明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-09T13:36:12+08:00">
                2019-08-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Math/" itemprop="url" rel="index">
                    <span itemprop="name">Math</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/09/%E7%9A%AE%E5%B0%94%E9%80%8A%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%B0%8F%E4%BA%8E1%E7%9A%84%E8%AF%81%E6%98%8E/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/08/09/%E7%9A%AE%E5%B0%94%E9%80%8A%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%B0%8F%E4%BA%8E1%E7%9A%84%E8%AF%81%E6%98%8E/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/08/09/%E7%9A%AE%E5%B0%94%E9%80%8A%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0%E7%BB%9D%E5%AF%B9%E5%80%BC%E5%B0%8F%E4%BA%8E1%E7%9A%84%E8%AF%81%E6%98%8E/" class="leancloud_visitors" data-flag-title="皮尔逊相关系数绝对值小于1的证明">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">517(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">2(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>皮尔逊相关系数的介绍可参考<a href="https://zh.wikipedia.org/wiki/%E7%9A%AE%E5%B0%94%E9%80%8A%E7%A7%AF%E7%9F%A9%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0" target="_blank" rel="noopener">维基百科:皮尔逊积矩相关系数</a></p>
<p>在统计学中，皮尔逊积矩相关系数（Pearson product-moment correlation coefficient，又称作 <strong>PPMCC</strong>或<strong>PCCs</strong>, 文章中常用r或Pearson’s r表示）用于度量两个变量X和Y之间的相关程度（线性相关）</p>
<p>两个变量的总体相关系数定义为两个变量之间的协方差与标准差的商</p>
<script type="math/tex; mode=display">
\rho_{xy}=\frac{cov(X,Y)}{\sigma_{x}\sigma_{y}}=\frac{E[(X-\mu_{X})(Y-\mu_{Y})]}{\sigma_{X}\sigma_{Y}} \tag{1.1}</script><p>估算样本的协方差和标准差，可得到样本相关系数</p>
<script type="math/tex; mode=display">
r=\frac{\sum_{i=1}^{n}{(X_{i}-\overline{X})(Y_{i}-\overline{Y})}}{\sqrt{\sum_{i=1}^{n}{(X_{i}-\overline{X})^{2}}}\sqrt{\sum_{i=1}^{n}{(Y_{i}-\overline{Y})^{2}}}} \tag{1.2}</script><p>r 亦可由样本点(<script type="math/tex">X_{i},Y_{i}</script>)的标准分数均值估算，得到与上式等价的表达式</p>
<script type="math/tex; mode=display">
r=\frac{1}{n-1}\sum_{i=1}^{n}{(\frac{X_{i}-\overline{X}}{\sigma_{X}})(\frac{Y_{i}-\overline{Y}}{\sigma_{Y}})} \tag{1.3}</script><p>其中<script type="math/tex">\frac{X-\overline{X}}{\sigma_{X}}、\overline{X}、\sigma_{X}</script>分别是<script type="math/tex">X_{i}</script>样本的标准分数、样本均值和样本标准差</p>
<p>总体和样本皮尔逊相关系数都小于或者等于1，可以由柯西-施瓦茨不等式证明，关于柯西-施瓦茨不等式的定义与证明具体可参考<a href="https://zh.wikipedia.org/wiki/%E6%9F%AF%E8%A5%BF-%E6%96%BD%E7%93%A6%E8%8C%A8%E4%B8%8D%E7%AD%89%E5%BC%8F" target="_blank" rel="noopener">维基百科:柯西-施瓦茨不等式</a>，下面将直接利用柯西-施瓦茨不等式来证明皮尔逊相关系数的绝对值小于1</p>
<font color="red" size=4>证明:</font>

<p>要证明式(1.2)中的r绝对值小于等于1即证明<script type="math/tex">r^{2}</script>小于等于1，设式(1.2)中的<script type="math/tex">X_{i}-\overline{X}=x_{i},Y_{i}-\overline{Y}=y_{i}</script>，代入<script type="math/tex">r^{2}</script>有</p>
<script type="math/tex; mode=display">
r^{2} = \frac{(\sum_{i=1}^{n}x_{i}y_{i})^{2}}{(\sum_{i=1}^{n}{x_{i}^{2}})(\sum_{i=1}^{n}{y_{i}^{2}})} \tag{1.4}</script><p>又由柯西-施瓦茨不等式知</p>
<script type="math/tex; mode=display">
(\sum_{i=1}^{n}{x_{i}y_{i}})^{2} \le (\sum_{i=1}^{n}{x_{i}^{2}})(\sum_{i=1}^{n}{y_{i}^{2}})</script><p>由此可知式(1.4)中的<script type="math/tex">r^2 \le 1</script>，即<script type="math/tex">|r| \le 1</script>，证毕!</p>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/08/08/%E5%90%84%E7%B1%BB%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/08/%E5%90%84%E7%B1%BB%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0tutorial/" itemprop="url">各类概率分布函数tutorial</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-08T19:00:03+08:00">
                2019-08-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Math/" itemprop="url" rel="index">
                    <span itemprop="name">Math</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/08/%E5%90%84%E7%B1%BB%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0tutorial/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/08/08/%E5%90%84%E7%B1%BB%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0tutorial/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/08/08/%E5%90%84%E7%B1%BB%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0tutorial/" class="leancloud_visitors" data-flag-title="各类概率分布函数tutorial">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">1.1k(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">4(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="泊松分布、指数分布与伽马分布简介及其关系"><a href="#泊松分布、指数分布与伽马分布简介及其关系" class="headerlink" title="泊松分布、指数分布与伽马分布简介及其关系"></a>泊松分布、指数分布与伽马分布简介及其关系</h2><p>泊松分布: <script type="math/tex">Poisson(N(t)=n)=\frac{(\lambda t)^{n}e^{- \lambda t}}{n!},\ (\lambda t > 0, n \ge 0)</script></p>
<p>指数分布: <script type="math/tex">f(x)=\lambda e^{-\lambda t},\ (\lambda > 0,t > 0)</script></p>
<p>伽马分布: 先看伽马函数，伽马函数又称第二类欧拉积分，函数式为<script type="math/tex">\Gamma(x)=\int_{0}^{\infty}{t^{x-1}e^{-t}dt}(x > 0)</script>，对伽马函数做一个变形即可得到</p>
<script type="math/tex; mode=display">
\int_{0}^{\infty}{\frac{x^{\alpha-1}e^{-x}}{\Gamma(\alpha)}}dx=1 \tag{1.1}</script><p>式(1.1)去除积分即为伽马分布的概率密度函数</p>
<script type="math/tex; mode=display">
Gamma(x|\alpha)=\frac{x^{\alpha-1}e^{-x}}{\Gamma(\alpha)},(x>0,\alpha>0)</script><p>令<script type="math/tex">\beta t=x</script>，代入积分公式(1.1)中则可得到新的概率密度函数</p>
<script type="math/tex; mode=display">
Gamma(t|\alpha)=\frac{\beta^{\alpha}t^{\alpha-1}e^{-\beta t}}{\Gamma(\alpha)},(\beta t>0,\alpha>0)</script><p>其中<script type="math/tex">\alpha</script>为shape parameter，主要决定了分布曲线的形状，<script type="math/tex">\beta</script>为scale parameter，主要决定曲线有多陡，<script type="math/tex">\beta</script>越大则曲线越陡。</p>
<p>伽马分布是为解决阶乘数列的插值而产生的，伽马函数使得任意正实数都有阶乘，伽马函数有几条特性如下:</p>
<ol>
<li><script type="math/tex; mode=display">\Gamma(x+1)=x\Gamma(x)</script></li>
<li><script type="math/tex; mode=display">\Gamma(n)=(n-1)!</script></li>
</ol>
<p>其中，<script type="math/tex">\Gamma(\frac{1}{2})=\sqrt{\pi},\frac{1}{2}!=\Gamma(\frac{3}{2})=\frac{1}{2}\Gamma(\frac{1}{2})=\frac{\sqrt{\pi}}{2}</script></p>
<font color='red' size=4>物理解释:</font>

<p>泊松分布: 单位时间t内独立事件发生次数n的概率分布</p>
<p>指数分布: 独立事件的时间间隔的概率分布</p>
<p>伽马分布: <script type="math/tex">\alpha</script>个独立事件的时间间隔的概率分布</p>
<font color="green" size=4>参考链接:</font>

<ul>
<li><p><a href="https://www.jianshu.com/p/6ee90ba47b4a" target="_blank" rel="noopener">伽马分布，指数分布，泊松分布的关系</a></p>
<p>这篇文章先讲述泊松分布，然后由泊松分布引出指数分布，说明了泊松分布与指数分布的关系，最后说明了伽马分布与指数分布的关系.</p>
</li>
<li><p><a href="">LDA-math-神奇的Gamma函数(3)</a></p>
<p>这篇文章由二项分布和Beta分布的关系式，借用二项分布的极限是泊松分布的性质转换得到泊松分布与伽马分布的关系式，以及泊松分布的概率累积函数与伽马分布的概率累积函数互补的关系。</p>
</li>
</ul>
<h2 id="Beta分布简介"><a href="#Beta分布简介" class="headerlink" title="Beta分布简介"></a>Beta分布简介</h2><p>Beta分布: 首先来看Beta函数，Beta函数又称贝塔函数或者第一类欧拉积分，它的函数式如下</p>
<script type="math/tex; mode=display">
B(\alpha, \beta)=\int_{0}^{1}x^{\alpha-1}(1-x)^{\beta-1}dx=\frac{\Gamma(\alpha)\Gamma(\beta)}{\Gamma(\alpha+\beta)},(x \in [0,1],\alpha \gt 0, \beta \gt 0) \tag{2.1}</script><p>对Beta函数作一个变形即可得到</p>
<script type="math/tex; mode=display">
\int_{0}^{1}{\frac{x^{\alpha-1}(1-x)^{\beta-1}}{B(\alpha,\beta)}dx}=1,(\alpha>0,\beta>0)</script><p>去除式(2.1)的积分即可得到Beta分布的概率密度函数</p>
<script type="math/tex; mode=display">
X\sim Be(\alpha,\beta):Beta(x|\alpha,\beta)=\frac{1}{B(\alpha,\beta)}x^{\alpha-1}(1-x)^{\beta-1}=\frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)}x^{\alpha-1}(1-x)^{\beta-1},(\alpha>0,\beta>0)</script><font color="green" size=4>参考链接:</font>

<ul>
<li><p><a href="http://www.52nlp.cn/lda-math-%E8%AE%A4%E8%AF%86betadirichlet%E5%88%86%E5%B8%831" target="_blank" rel="noopener">LDA-math-认识Beta/Dirichlet分布(1)</a></p>
<p>这篇文章由掷骰子游戏从物理上解释了Beta分布的由来</p>
</li>
<li><p><a href="http://www.52nlp.cn/lda-math-%E8%AE%A4%E8%AF%86betadirichlet%E5%88%86%E5%B8%832" target="_blank" rel="noopener">LDA-math-认识Beta/Dirichlet分布(2)</a></p>
<p>这篇文章在上一篇文章的基础上通过更新掷骰子的游戏规则引出了Beta分布与二项分布的共轭分布关系，共轭的意思就是，数据符合二项分布的时候，参数的先验分布和后验分布都能保持Beta 分布的形式。我们知道贝叶斯的参数估计过程是</p>
<script type="math/tex; mode=display">
先验分布\ + \ 数据的知识\ =\ 后验分布</script><p>对应到beta分布和二项分布的共轭</p>
<script type="math/tex; mode=display">
Beta(p|\alpha, \beta)\ +\ Binomial(m1|m1+m2,p)\ =\ Beta(p|\alpha+m1,\beta+m2)</script></li>
</ul>
<h2 id="Dirichlet分布简介"><a href="#Dirichlet分布简介" class="headerlink" title="Dirichlet分布简介"></a>Dirichlet分布简介</h2><p>Multinomial分布: 中文名多项式分布</p>
<script type="math/tex; mode=display">
Mult(\vec{n}|\vec{p},N)=\binom{N}{\vec{n}}\prod_{k=1}^{K}{p_{k}^{n_{k}}}</script><p>Dirichlet分布: 中文名狄利克雷分布</p>
<script type="math/tex; mode=display">
Dir(\vec{p}|\vec{\alpha})=\frac{\Gamma(\sum_{k=1}^{K}{\alpha_k})}{\sum_{k=1}^{K}\Gamma(\alpha_{k})}{\prod_{k=1}^{K}{p_{k}^{\alpha_{k}-1}}}</script><font color="green" size=4>参考链接:</font>

<ul>
<li><p><a href="http://www.52nlp.cn/lda-math-%E8%AE%A4%E8%AF%86betadirichlet%E5%88%86%E5%B8%833" target="_blank" rel="noopener">LDA-math-认识Beta/Dirichlet分布(3)</a></p>
<p>这篇文章由掷骰子的游戏引出Dirichlet分布，并且通过改变游戏规则引出Dirichlet分布与Multinomial分布的关系，但是在推导共轭关系时定义有些许错误要注意</p>
</li>
<li><p><a href="https://v.youku.com/v_show/id_XMzI4NzI4Mjg5Mg==.html?spm=a2hzp.8244740.0.0" target="_blank" rel="noopener">LDA基础知识—-Dirichlet 分布</a></p>
<p>这是优酷上讲解LDA的Dirichlet分布的视频</p>
</li>
</ul>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/07/24/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95%E9%9B%86%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/24/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95%E9%9B%86%E6%88%90/" itemprop="url">多项式相关算法集成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-24T15:39:03+08:00">
                2019-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/24/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95%E9%9B%86%E6%88%90/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/07/24/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95%E9%9B%86%E6%88%90/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/24/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95%E9%9B%86%E6%88%90/" class="leancloud_visitors" data-flag-title="多项式相关算法集成">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">2.1k(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">11(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h3 id="快速数论变换-FNT"><a href="#快速数论变换-FNT" class="headerlink" title="快速数论变换(FNT)"></a>快速数论变换(FNT)</h3><p>原理同<a href="https://brooksj.com/2019/07/18/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/">FFT</a>一样,用与弧度具有同样性质的一组值替代弧度进行计算,具体性质如下:</p>
<p>FFT 中能在 O(nlog⁡n) 时间内变换用到了单位根 <script type="math/tex">\omega</script> 的什么性质:</p>
<ol>
<li><p>$\omega_n^n = 1$</p>
</li>
<li><p><script type="math/tex">\omega_{n}^{0}</script>, <script type="math/tex">\omega_{n}^{1}</script>, ⋯, <script type="math/tex">\omega_{n}^{n-1}</script>是互不相同的，这样带入计算出来的点值才可以用来还原出系数</p>
</li>
<li><p><script type="math/tex">\omega_{n}^{2}=\omega_{n/2}^{1}</script>, <script type="math/tex">\omega_{n}^{n/2+k}=-\omega_{n}^{k}</script>，这使得在按照指数奇偶分类之后能够把带入的值也减半使得问题规模能够减半</p>
</li>
<li><script type="math/tex; mode=display">
\sum_{k=0}^{n-1}(\omega_{n}^{j-i})^{k}=\begin{cases}
0,& \text{若i != j}\\
1,& \text{若i = j}
\end{cases}</script></li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这点保证了能够使用相同的方法进行逆变换得到系数表示</p>
<p><em>参考:</em></p>
<ol>
<li><p><a href="http://blog.miskcoo.com/2015/04/polynomial-multiplication-and-fast-fourier-transform#i-13" target="_blank" rel="noopener">从多项式乘法到快速傅里叶变换</a></p>
</li>
<li><p><a href="https://riteme.site/blog/2016-8-22/ntt.html" target="_blank" rel="noopener">快速数论变换 (NTT)</a></p>
</li>
<li><p><a href="http://blog.miskcoo.com/2014/07/fft-prime-table" target="_blank" rel="noopener">FNT用到的各种素数</a></p>
</li>
</ol>
<h3 id="多项式逆元"><a href="#多项式逆元" class="headerlink" title="多项式逆元"></a>多项式逆元</h3><p><em>参考:</em></p>
<ol>
<li><a href="http://blog.miskcoo.com/2015/05/polynomial-inverse" target="_blank" rel="noopener">多项式求逆元</a></li>
</ol>
<h3 id="多项式除法及求模"><a href="#多项式除法及求模" class="headerlink" title="多项式除法及求模"></a>多项式除法及求模</h3><p><em>参考:</em></p>
<ol>
<li><a href="http://blog.miskcoo.com/2015/05/polynomial-division" target="_blank" rel="noopener">多项式除法及求模</a></li>
</ol>
<h3 id="多项式多点求值与拉格朗日插值"><a href="#多项式多点求值与拉格朗日插值" class="headerlink" title="多项式多点求值与拉格朗日插值"></a>多项式多点求值与拉格朗日插值</h3><p><em>参考:</em></p>
<ol>
<li><a href="http://blog.miskcoo.com/2015/05/polynomial-multipoint-eval-and-interpolation" target="_blank" rel="noopener">多项式的多点求值与快速插值</a></li>
<li><a href="https://www.cnblogs.com/zzqsblog/p/7923192.html" target="_blank" rel="noopener">多项式多点求值和插值</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC%E6%B3%95" target="_blank" rel="noopener">维基百科:拉格朗日插值法</a></li>
</ol>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 多项式相关算法模板集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="comment">// 2281701377是一个原根为3的指数,平方刚好不会爆long long</span></span><br><span class="line"><span class="comment">// 另外一个常用的998244353 = 119ll * (1 &lt;&lt; 23) + 1</span></span><br><span class="line"><span class="comment">// 1004535809=479⋅221+1 加起来刚好不会爆 int 也不错</span></span><br><span class="line"><span class="keyword">const</span> ll mod_v = <span class="number">17l</span>l * (<span class="number">1</span> &lt;&lt; <span class="number">27</span>) + <span class="number">1</span>;  </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">18</span>, N = <span class="number">1</span> &lt;&lt; MAXL, M = <span class="number">1</span> &lt;&lt; MAXL;  <span class="comment">// MAXL最大取mov_v的2次幂</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">polynomial</span> &#123;</span></span><br><span class="line">​    ll coef[N]; <span class="comment">// size设为多项式系数个数的两倍</span></span><br><span class="line">​    ll a[N], b[N], d[N], r[N];</span><br><span class="line">​    ll xcoor[N], ycoor[N], v[N], mcoef[N];  <span class="comment">// size设为点个数的两倍</span></span><br><span class="line">​    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;ll&gt; &gt; poly_divisor;</span><br><span class="line">​     </span><br><span class="line">​    <span class="function"><span class="keyword">static</span> ll <span class="title">mod_pow</span><span class="params">(ll x,ll n,ll m)</span> </span>&#123;</span><br><span class="line">​        ll ans = <span class="number">1</span>;</span><br><span class="line">​        <span class="keyword">while</span>(n &gt; <span class="number">0</span>)&#123;</span><br><span class="line">​    	    <span class="keyword">if</span>(n &amp; <span class="number">1</span>)</span><br><span class="line">​    	        ans = ans*x%m;</span><br><span class="line">​    	    x = x*x%m;</span><br><span class="line">​    	    n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">​        &#125;</span><br><span class="line">​        <span class="keyword">return</span> ans;</span><br><span class="line">​    &#125;</span><br><span class="line">​     </span><br><span class="line">​    <span class="class"><span class="keyword">struct</span> <span class="title">FastNumberTheoreticTransform</span>  &#123;</span></span><br><span class="line">​        ll omega[N], omegaInverse[N];</span><br><span class="line">​        <span class="keyword">int</span> range;</span><br><span class="line">​    </span><br><span class="line">​        <span class="comment">// 初始化频率</span></span><br><span class="line">​        <span class="function"><span class="keyword">void</span> <span class="title">init</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; n)</span> </span>&#123;</span><br><span class="line">​    	    range = n;</span><br><span class="line">​        	ll base = mod_pow(<span class="number">3</span>, (mod_v - <span class="number">1</span>) / n, mod_v);</span><br><span class="line">​        	ll inv_base = mod_pow(base, mod_v - <span class="number">2</span>, mod_v);</span><br><span class="line">​        	omega[<span class="number">0</span>] = omegaInverse[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">​        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">​        	    omega[i] = omega[i - <span class="number">1</span>] * base % mod_v;</span><br><span class="line">​        	    omegaInverse[i] = omegaInverse[i - <span class="number">1</span>] * inv_base % mod_v;</span><br><span class="line">​        	&#125;</span><br><span class="line">​        &#125;</span><br><span class="line">​        </span><br><span class="line">​        <span class="comment">// Cooley-Tukey算法:O(n*logn)</span></span><br><span class="line">​        <span class="function"><span class="keyword">void</span> <span class="title">transform</span> <span class="params">(ll *a, <span class="keyword">const</span> ll *omega, <span class="keyword">const</span> <span class="keyword">int</span> &amp;n)</span> </span>&#123;</span><br><span class="line">​        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">​        		    <span class="keyword">if</span> (i &gt; j) <span class="built_in">std</span>::swap (a[i], a[j]);</span><br><span class="line">​            		<span class="keyword">for</span>(<span class="keyword">int</span> l = n &gt;&gt; <span class="number">1</span>; ( j ^= l ) &lt; l; l &gt;&gt;= <span class="number">1</span>);</span><br><span class="line">​            &#125;</span><br><span class="line">​        </span><br><span class="line">​        	<span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">2</span>; l &lt;= n; l &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">​        	    <span class="keyword">int</span> m = l / <span class="number">2</span>;</span><br><span class="line">​        	    <span class="keyword">for</span> (ll *p = a; p != a + n; p += l) &#123;</span><br><span class="line">​        	        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">​        	            ll t = omega[range / l * i] * p[m + i] % mod_v;</span><br><span class="line">​        	            p[m + i] = (p[i] - t + mod_v) % mod_v;</span><br><span class="line">​        	            p[i] = (p[i] + t) % mod_v;</span><br><span class="line">​        	        &#125;</span><br><span class="line">​        	    &#125;</span><br><span class="line">​        	&#125;</span><br><span class="line">​        &#125;</span><br><span class="line">​        </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 时域转频域</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">dft</span> <span class="params">(ll *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n)</span> </span>&#123;</span><br><span class="line">    	    transform(a, omega, n);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 频域转时域</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">idft</span> <span class="params">(ll *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n)</span> </span>&#123;</span><br><span class="line">    	    transform(a, omegaInverse, n);</span><br><span class="line">    	    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) a[i] = a[i] * mod_pow(n, mod_v - <span class="number">2</span>, mod_v) % mod_v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; fnt ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 与模比较转换值</span></span><br><span class="line">    <span class="function">ll <span class="title">mod_trans</span><span class="params">(ll v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">abs</span>(v) &lt;= mod_v / <span class="number">2</span> ? v : (v &lt; <span class="number">0</span> ? v + mod_v : v - mod_v);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 二分求\prod&#123;x-xi&#125;的所有二分子多项式的系数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">binary_subpoly</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r - <span class="number">1</span>) &#123;</span><br><span class="line">    	    poly_divisor[idx].push_back(-xcoor[l]);</span><br><span class="line">    	    poly_divisor[idx].push_back(<span class="number">1</span>);        </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">int</span> lidx = (idx &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>, ridx = lidx + <span class="number">1</span>;</span><br><span class="line">        	binary_subpoly(l, (l + r) / <span class="number">2</span>, lidx);</span><br><span class="line">        	binary_subpoly((l + r) / <span class="number">2</span>, r, ridx);</span><br><span class="line">        	<span class="keyword">int</span> t = poly_divisor[lidx].<span class="built_in">size</span>() + poly_divisor[ridx].<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        	<span class="keyword">int</span> p = <span class="number">1</span>;</span><br><span class="line">        	<span class="keyword">while</span>(p &lt; t) p &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        	copy(poly_divisor[lidx].<span class="built_in">begin</span>(), poly_divisor[lidx].<span class="built_in">end</span>(), a);</span><br><span class="line">        	<span class="built_in">fill</span>(a + poly_divisor[lidx].<span class="built_in">size</span>(), a + p, <span class="number">0</span>);</span><br><span class="line">        	copy(poly_divisor[ridx].<span class="built_in">begin</span>(), poly_divisor[ridx].<span class="built_in">end</span>(), b);</span><br><span class="line">        	<span class="built_in">fill</span>(b + poly_divisor[ridx].<span class="built_in">size</span>(), b + p, <span class="number">0</span>);</span><br><span class="line">        	fnt.dft(a, p);</span><br><span class="line">        	fnt.dft(b, p);</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++)  a[i] *= b[i]; </span><br><span class="line">        	fnt.idft(a, p);</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; i++) poly_divisor[idx].push_back(mod_trans(a[i]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模x^deg,a为要求逆元的多项式系数,结果存放在b[0~deg]中</span></span><br><span class="line">    <span class="comment">// T(deg) = T(deg/2) + deg*log(deg)，复杂度O(deg*log(deg))</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">polynomial_inverse</span><span class="params">(<span class="keyword">int</span> deg, ll* a, ll* b, ll* tmp)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">if</span>(deg == <span class="number">1</span>) &#123;</span><br><span class="line">    		b[<span class="number">0</span>] = mod_pow(a[<span class="number">0</span>], mod_v - <span class="number">2</span>, mod_v);</span><br><span class="line">    	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    		polynomial_inverse((deg + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, a, b, tmp);</span><br><span class="line">    		<span class="keyword">int</span> p = <span class="number">1</span>;</span><br><span class="line">    		<span class="keyword">while</span>(p &lt; (deg &lt;&lt; <span class="number">1</span>) - <span class="number">1</span>) p &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    		copy(a, a + deg, tmp);</span><br><span class="line">    		<span class="built_in">fill</span>(tmp + deg, tmp + p, <span class="number">0</span>);</span><br><span class="line">    	    <span class="built_in">fill</span>(b + ((deg + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>), b + p, <span class="number">0</span>);</span><br><span class="line">    	    <span class="comment">//fnt.init(p);</span></span><br><span class="line">    	    fnt.dft(tmp, p);</span><br><span class="line">    	    fnt.dft(b, p);</span><br><span class="line">    		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i != p; ++i) &#123;</span><br><span class="line">    			b[i] = (<span class="number">2</span> - tmp[i] * b[i] % mod_v) * b[i] % mod_v;</span><br><span class="line">    			<span class="keyword">if</span>(b[i] &lt; <span class="number">0</span>) b[i] += mod_v;</span><br><span class="line">    		&#125;</span><br><span class="line">    	    fnt.idft(b, p);</span><br><span class="line">    		<span class="built_in">fill</span>(b + deg, b + p, <span class="number">0</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// A = D*B + R,A为n项n-1次幂,B为m项m-1次幂,D为n-m+1项n-m次幂,R为m-1项m-2次幂</span></span><br><span class="line">    <span class="comment">// 要求a,b中系数以低次到多次顺序排列</span></span><br><span class="line">    <span class="comment">// n &gt;= m，复杂度O(n*logn)；n &lt; m，复杂度O(n)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">polynomial_division</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m, ll *A, ll *B, ll *D, ll *R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; m) &#123;</span><br><span class="line">    	    copy(A, A + n, R);</span><br><span class="line">    	    <span class="keyword">return</span> n;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	    <span class="keyword">static</span> ll A0[N], B0[N], tmp[N]; <span class="comment">//数组太大会爆栈,添加到全局区</span></span><br><span class="line">    </span><br><span class="line">    	    <span class="keyword">int</span> p = <span class="number">1</span>, t = n - m + <span class="number">1</span>;</span><br><span class="line">    	    <span class="keyword">while</span>(p &lt; (t &lt;&lt; <span class="number">1</span>) - <span class="number">1</span>) p &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    	    <span class="built_in">fill</span>(A0, A0 + p, <span class="number">0</span>);</span><br><span class="line">    	    reverse_copy(B, B + m, A0);</span><br><span class="line">    	    polynomial_inverse(t, A0, B0, tmp);</span><br><span class="line">    	    <span class="built_in">fill</span>(B0 + t, B0 + p, <span class="number">0</span>);</span><br><span class="line">    	    fnt.dft(B0, p);</span><br><span class="line">    </span><br><span class="line">    	    reverse_copy(A, A + n, A0);</span><br><span class="line">    	    <span class="built_in">fill</span>(A0 + t, A0 + p, <span class="number">0</span>);</span><br><span class="line">    	    fnt.dft(A0, p);</span><br><span class="line">    </span><br><span class="line">    	    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i != p; ++i)</span><br><span class="line">    	    	A0[i] = A0[i] * B0[i] % mod_v;</span><br><span class="line">    	    fnt.idft(A0, p);</span><br><span class="line">    	    reverse(A0, A0 + t);</span><br><span class="line">    	    copy(A0, A0 + t, D);</span><br><span class="line">    </span><br><span class="line">    	    <span class="keyword">for</span>(p = <span class="number">1</span>; p &lt; n; p &lt;&lt;= <span class="number">1</span>);</span><br><span class="line">    	    <span class="built_in">fill</span>(A0 + t, A0 + p, <span class="number">0</span>);</span><br><span class="line">    	    fnt.dft(A0, p);</span><br><span class="line">    	    copy(B, B + m, B0);</span><br><span class="line">    	    <span class="built_in">fill</span>(B0 + m, B0 + p, <span class="number">0</span>);</span><br><span class="line">    	    fnt.dft(B0, p);</span><br><span class="line">    	    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i != p; ++i)</span><br><span class="line">    	    	A0[i] = A0[i] * B0[i] % mod_v;</span><br><span class="line">    	    fnt.idft(A0, p);</span><br><span class="line">    	    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i != m - <span class="number">1</span>; ++i)</span><br><span class="line">    	    	R[i] = ((A[i] - A0[i]) % mod_v + mod_v) % mod_v;</span><br><span class="line">    	    <span class="comment">//fill(R + m - 1, R + p, 0);</span></span><br><span class="line">    	    <span class="keyword">return</span> m - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多项式的点值计算</span></span><br><span class="line">    <span class="comment">// l和r为存储要求的点数组的左右边界(左闭右开), idx为除数多项式索引(初始０)</span></span><br><span class="line">    <span class="comment">// polycoef为用于计算点的多项式系数，num为其系数个数</span></span><br><span class="line">    <span class="comment">// 设多项式项数x=num，点数y=r-l，n=max(x,y)，复杂度O(n(logn)^2)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">polynomial_calculator</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> idx, <span class="keyword">int</span> num, ll *polycoef)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> lidx = (idx &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>, ridx = lidx + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> lsize = poly_divisor[lidx].<span class="built_in">size</span>(), rsize = poly_divisor[ridx].<span class="built_in">size</span>();</span><br><span class="line">        ll *lmod_poly = <span class="keyword">new</span> ll[lsize - <span class="number">1</span>], *rmod_poly = <span class="keyword">new</span> ll[rsize - <span class="number">1</span>];</span><br><span class="line">        copy(poly_divisor[lidx].<span class="built_in">begin</span>(), poly_divisor[lidx].<span class="built_in">end</span>(), a);</span><br><span class="line">        copy(poly_divisor[ridx].<span class="built_in">begin</span>(), poly_divisor[ridx].<span class="built_in">end</span>(), b);</span><br><span class="line">        <span class="keyword">int</span> lplen = polynomial_division(num, lsize, polycoef, a, d, lmod_poly);</span><br><span class="line">        <span class="keyword">int</span> rplen = polynomial_division(num, rsize, polycoef, b, d, rmod_poly);</span><br><span class="line">        <span class="keyword">if</span> (l == mid - <span class="number">1</span>) &#123;</span><br><span class="line">    	    v[l] = mod_trans(lmod_poly[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	    polynomial_calculator(l, (l + r) / <span class="number">2</span>, lidx, lplen, lmod_poly);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r == mid + <span class="number">1</span>) &#123;</span><br><span class="line">    	    v[(l + r) / <span class="number">2</span>] = mod_trans(rmod_poly[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	    polynomial_calculator((l + r) / <span class="number">2</span>, r, ridx, rplen, rmod_poly);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span> []lmod_poly;</span><br><span class="line">        <span class="keyword">delete</span> []rmod_poly;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 拉格朗日插值：二分＋快速数论变换</span></span><br><span class="line">    <span class="comment">// l和r为存储要求的点数组的左右边界(左闭右开), idx为由点二分构造出多项式的索引(初始０)</span></span><br><span class="line">    <span class="comment">// polycoef为插值得到的多项式结果</span></span><br><span class="line">    <span class="comment">// 设点个数为n，复杂度O(n*(logn)^2)，结果polycoef为n-1次多项式</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">polynomial_interpolate</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> idx, ll *polycoef)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r - <span class="number">1</span>) &#123;</span><br><span class="line">    	    polycoef[<span class="number">0</span>] = ycoor[l] * mod_pow(v[l], mod_v - <span class="number">2</span>, mod_v) % mod_v;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        	<span class="keyword">int</span> lidx = (idx &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>, ridx = lidx + <span class="number">1</span>;</span><br><span class="line">        	<span class="keyword">int</span> sz = poly_divisor[idx].<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        	<span class="keyword">int</span> lsize = poly_divisor[lidx].<span class="built_in">size</span>(), rsize = poly_divisor[ridx].<span class="built_in">size</span>();</span><br><span class="line">        	<span class="keyword">int</span> p = <span class="number">1</span>;</span><br><span class="line">        	<span class="keyword">while</span> (p &lt; sz) p &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        	ll *leftpoly = <span class="keyword">new</span> ll[p], *rightpoly = <span class="keyword">new</span> ll[p];</span><br><span class="line">        	polynomial_interpolate(l, mid, lidx, leftpoly);</span><br><span class="line">        	polynomial_interpolate(mid, r, ridx, rightpoly);</span><br><span class="line">        	copy(poly_divisor[lidx].<span class="built_in">begin</span>(), poly_divisor[lidx].<span class="built_in">end</span>(), a);</span><br><span class="line">        	copy(poly_divisor[ridx].<span class="built_in">begin</span>(), poly_divisor[ridx].<span class="built_in">end</span>(), b);</span><br><span class="line">        	<span class="built_in">fill</span>(leftpoly + lsize - <span class="number">1</span>, leftpoly + p, <span class="number">0</span>);</span><br><span class="line">        	<span class="built_in">fill</span>(rightpoly + rsize - <span class="number">1</span>, rightpoly + p, <span class="number">0</span>);</span><br><span class="line">        	<span class="built_in">fill</span>(a + lsize, a + p, <span class="number">0</span>);</span><br><span class="line">        	<span class="built_in">fill</span>(b + rsize, b + p, <span class="number">0</span>);</span><br><span class="line">        	fnt.dft(leftpoly, p);</span><br><span class="line">        	fnt.dft(b, p);</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) leftpoly[i] = leftpoly[i] * b[i] % mod_v;</span><br><span class="line">        	fnt.idft(leftpoly, p);</span><br><span class="line">        	fnt.dft(rightpoly, p);</span><br><span class="line">        	fnt.dft(a, p);</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) rightpoly[i] = rightpoly[i] * a[i] % mod_v;</span><br><span class="line">        	fnt.idft(rightpoly, p);</span><br><span class="line">        	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) polycoef[i] = mod_trans((leftpoly[i] + rightpoly[i]) % mod_v); </span><br><span class="line">        	<span class="keyword">delete</span> []leftpoly;</span><br><span class="line">        	<span class="keyword">delete</span> []rightpoly; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化点个数到二分子多项式个数</span></span><br><span class="line">    <span class="comment">// 调用polynomial_calculator和polynomial_interpolate前调用</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> vnum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> vnum2 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (vnum2 &lt; vnum) vnum2 &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span> * vnum2 - <span class="number">1</span>; i++)  poly_divisor.push_back(<span class="built_in">vector</span>&lt;ll&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; poly;</span><br></pre></td></tr></table></figure>
</details>


<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="多项式快速乘"><a href="#多项式快速乘" class="headerlink" title="多项式快速乘"></a>多项式快速乘</h3><details>
<summary>展开代码</summary>
​```c++
int main() {
    ios_base::sync_with_stdio(false);
    poly.fnt.init(1 << MAXL);
    int n, m;
    cin >> n >> m;
    for (int i = 0; i < n; i++) cin >> poly.a[i];
    for (int i = 0; i < m; i++) cin >> poly.b[i];
    cout << "a*b之后的真实系数:" << endl;
    for (int i = 0; i < n; i++)
        for (int j = 0; j < m; j++)
            poly.r[i + j] += poly.a[i] * poly.b[j];
    for (int i = 0; i < n + m - 1; i++)
        cout << poly.r[i] << " ";
    cout << endl;
    cout << "利用fft计算得出的系数:" << endl;
    int p = 1;
    while (p < n + m - 1) p <<= 1;  // 只要p大于多项式结果中的最大次幂即可
    poly.fnt.dft(poly.a, p);
    poly.fnt.dft(poly.b, p);
    for (int i = 0; i < p; i++) {
        poly.d[i] = poly.a[i] * poly.b[i] % mod_v;
    }
    poly.fnt.idft(poly.d, p);
    for (int i = 0; i < n + m - 1; i++) cout << poly.d[i] << " ";
    return 0;
}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;details&gt;</span><br><span class="line"></span><br><span class="line">&lt;div align&#x3D;&quot;center&quot;&gt;</span><br><span class="line">    &lt;img src&#x3D;&quot;&#x2F;images&#x2F;poly&#x2F;poly5.png&quot;&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">### 多项式逆元</span><br><span class="line"></span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;展开代码&lt;&#x2F;summary&gt;</span><br><span class="line">&#96;&#96;&#96;c++</span><br><span class="line">int main() &#123;</span><br><span class="line">    ios_base::sync_with_stdio(false);</span><br><span class="line">    poly.fnt.init(1 &lt;&lt; MAXL);</span><br><span class="line">    int n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    for(int i &#x3D; 0; i !&#x3D; n; ++i)</span><br><span class="line">        cin &gt;&gt; poly.a[i];</span><br><span class="line">    int m;</span><br><span class="line">    cin &gt;&gt; m;  &#x2F;&#x2F; 输入模x^m</span><br><span class="line">    poly.polynomial_inverse(m, poly.a, poly.b, poly.d);</span><br><span class="line">    cout &lt;&lt; &quot;inverse: &quot; &lt;&lt; endl;</span><br><span class="line">    for(int i &#x3D; 0; i !&#x3D; m; ++i)</span><br><span class="line">        cout &lt;&lt; (poly.b[i] + mod_v) % mod_v &lt;&lt; &quot; &quot;;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;a*b相乘取模验证取模后的前m项系数:&quot; &lt;&lt; endl;</span><br><span class="line">    memset(poly.d, 0, sizeof(poly.d));</span><br><span class="line">    for (int i &#x3D; 0; i &lt; n; i++) &#123;</span><br><span class="line">        for (int j &#x3D; 0; j &lt; m; j++) &#123;</span><br><span class="line">            poly.d[i + j] &#x3D; (poly.d[i + j] + poly.a[i] * poly.b[j] % mod_v)% mod_v;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">    cout &lt;&lt; m &lt;&lt; endl;</span><br><span class="line">    for (int i &#x3D; 0; i &lt; m; i++) &#123;</span><br><span class="line">        cout &lt;&lt; poly.d[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;   </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<p>输入数据得到输出后的结果如下图</p>
<div align="center">
    <img src="/images/poly/poly4.png">
</div>

<h3 id="多项式除法以及取模"><a href="#多项式除法以及取模" class="headerlink" title="多项式除法以及取模"></a>多项式除法以及取模</h3><details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    poly.fnt.init(<span class="number">1</span> &lt;&lt; MAXL);</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i != n; ++i)</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; poly.a[i]; <span class="comment">// 0次幂系数开始输入,缺失的幂系数输入0</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; poly.b[i]; <span class="comment">// 0次幂系数开始输入</span></span><br><span class="line">    <span class="keyword">int</span> rlen = poly.polynomial_division(n, m, poly.a, poly.b, poly.d, poly.r);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输出商多项式:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - m + <span class="number">1</span>; i++) </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; poly.d[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"输出余数多项式:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rlen; i++)</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; poly.r[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<div align="center">
    <img src="/images/poly/poly3.png">
</div>

<h3 id="多项式多点求值"><a href="#多项式多点求值" class="headerlink" title="多项式多点求值"></a>多项式多点求值</h3><details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    poly.fnt.init(<span class="number">1</span> &lt;&lt; MAXL);</span><br><span class="line">    <span class="keyword">int</span> n, vnum; </span><br><span class="line">    <span class="comment">// 输入要计算的点</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; poly.coef[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; vnum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vnum; i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; poly.xcoor[i];        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 二分求子多项式                                                                               </span></span><br><span class="line">    poly.init(vnum);</span><br><span class="line">    poly.binary_subpoly(<span class="number">0</span>, vnum / <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    poly.binary_subpoly(vnum / <span class="number">2</span>, vnum, <span class="number">2</span>); </span><br><span class="line">    <span class="comment">// 将输入点代入插值得到的多项式中进行验证，输出计算得到的结果</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"计算结果:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    poly.polynomial_calculator(<span class="number">0</span>, vnum, <span class="number">0</span>, n, poly.coef);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vnum; i++) <span class="built_in">cout</span> &lt;&lt; poly.v[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<p>输入数据后得到结果如下</p>
<div align="center">
    <img src="/images/poly/poly2.png">
</div>

<h3 id="拉格朗日快速插值计算"><a href="#拉格朗日快速插值计算" class="headerlink" title="拉格朗日快速插值计算"></a>拉格朗日快速插值计算</h3><details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 多项式系数默认低次到高次排列</span></span><br><span class="line">    ios_base::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    poly.fnt.init(<span class="number">1</span> &lt;&lt; MAXL);   </span><br><span class="line">    <span class="comment">// 多项式插值</span></span><br><span class="line">    <span class="keyword">int</span> vnum; </span><br><span class="line">    <span class="comment">// 输入要计算的点</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; vnum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vnum; i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; poly.xcoor[i] &gt;&gt; poly.ycoor[i];        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 二分求子多项式</span></span><br><span class="line">    poly.init(vnum);</span><br><span class="line">    poly.binary_subpoly(<span class="number">0</span>, vnum, <span class="number">0</span>); </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt; poly.poly_divisor[<span class="number">0</span>].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        poly.mcoef[i - <span class="number">1</span>] = poly.poly_divisor[<span class="number">0</span>][i] * i % mod_v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 遍历i计算所有\sum_&#123;j!=i&#125;&#123;xi-xj&#125; </span></span><br><span class="line">    poly.polynomial_calculator(<span class="number">0</span>, vnum, <span class="number">0</span>, poly.poly_divisor[<span class="number">0</span>].<span class="built_in">size</span>() - <span class="number">1</span>, poly.mcoef);</span><br><span class="line">    <span class="comment">// 拉格朗日插值计算多项式</span></span><br><span class="line">    poly.polynomial_interpolate(<span class="number">0</span>, vnum, <span class="number">0</span>, poly.coef);</span><br><span class="line">    <span class="comment">// 输出插值得到的多项式系数 </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vnum; i++) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; poly.coef[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// 将输入点代入插值得到的多项式中进行验证，输出计算得到的结果</span></span><br><span class="line">    poly.polynomial_calculator(<span class="number">0</span>, vnum, <span class="number">0</span>, vnum, poly.coef);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vnum; i++) <span class="built_in">cout</span> &lt;&lt; poly.v[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<p>输入数据得到的结果如下</p>
<div align="center">
    <img src="/images/poly/poly1.png">
</div>


          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/07/18/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/18/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/" itemprop="url">快速傅里叶变换原理及其实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-18T22:39:42+08:00">
                2019-07-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/18/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/07/18/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/18/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/" class="leancloud_visitors" data-flag-title="快速傅里叶变换原理及其实现">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">1.1k(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">6(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>参考:</p>
<p><a href="https://www.jianshu.com/p/73f0ab14828a" target="_blank" rel="noopener">如何给文科生解释傅里叶变换</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/31584464" target="_blank" rel="noopener">一小时学会快速傅里叶变换（Fast Fourier Transform）</a></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><ul>
<li><p><strong>使用C++内置的complex</strong></p>
<details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">18</span>, N = <span class="number">1</span> &lt;&lt; MAXL;  <span class="comment">// 序列周期大小</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FastFourierTransform</span>  &#123;</span></span><br><span class="line">​    <span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; omega[N], omegaInverse[N];</span><br><span class="line">​    <span class="keyword">int</span> range;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化频率</span></span><br><span class="line">    <span class="comment">// 可以只进行一次初始化,只要大于可能出现的最高次幂即可,后面的转换就可以复用初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; n)</span> </span>&#123;</span><br><span class="line">        range = n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            omega[i] = <span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt;(<span class="built_in">cos</span>(<span class="number">2</span> * PI / n * i), <span class="built_in">sin</span>( <span class="number">2</span> * PI / n * i )) ;</span><br><span class="line">            omegaInverse[i] = <span class="built_in">std</span>::conj(omega[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Cooley-Tukey算法:O(n*logn)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transform</span> <span class="params">(<span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; *a, <span class="keyword">const</span> <span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; *omega, <span class="keyword">const</span> <span class="keyword">int</span> &amp;n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    	    <span class="keyword">if</span> (i &gt; j) <span class="built_in">std</span>::swap (a[i], a[j]);</span><br><span class="line">    		<span class="keyword">for</span>(<span class="keyword">int</span> l = n &gt;&gt; <span class="number">1</span>; ( j ^= l ) &lt; l; l &gt;&gt;= <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">2</span>; l &lt;= n; l &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> m = l / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; *p = a; p != a + n; p += l) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">                    <span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; t = omega[range / l * i] * p[m + i];</span><br><span class="line">                    p[m + i] = p[i] - t;</span><br><span class="line">                    p[i] += t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 时域转频域</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dft</span> <span class="params">(<span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n)</span> </span>&#123;</span><br><span class="line">        transform(a, omega, n);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 频域转时域</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">idft</span> <span class="params">(<span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n)</span> </span>&#123;</span><br><span class="line">        transform(a, omegaInverse, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) a[i] /= n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; fft ;</span><br></pre></td></tr></table></figure>
</details>



</li>
</ul>
<ul>
<li><p><strong>使用自定义的complex,两者在精度上有细微差别但影响不大</strong></p>
<details>
    <summary>展开代码</summary>
    <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXL = <span class="number">18</span>, N = <span class="number">1</span> &lt;&lt; MAXL;  <span class="comment">// 序列周期大小</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Complex</span>  &#123;</span></span><br><span class="line">    <span class="keyword">double</span> r, i ;</span><br><span class="line">    Complex ( )  &#123;	&#125;</span><br><span class="line">    Complex ( <span class="keyword">double</span> r, <span class="keyword">double</span> i ) : r ( r ), i ( i )  &#123;	&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">real</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">double</span> &amp;x )</span>  </span>&#123;  r = x ;  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">real</span> <span class="params">( )</span>  </span>&#123;  <span class="keyword">return</span> r ;  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">imag</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span> &amp;x)</span> </span>&#123; i = x; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">imag</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i; &#125;</span><br><span class="line">    <span class="keyword">inline</span> Complex <span class="keyword">operator</span> + ( <span class="keyword">const</span> Complex&amp; rhs )  <span class="keyword">const</span>  &#123;</span><br><span class="line">        <span class="keyword">return</span> Complex ( r + rhs.r, i + rhs.i ) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> Complex <span class="keyword">operator</span> - ( <span class="keyword">const</span> Complex&amp; rhs )  <span class="keyword">const</span>  &#123;</span><br><span class="line">        <span class="keyword">return</span> Complex ( r - rhs.r, i - rhs.i ) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> Complex <span class="keyword">operator</span> * ( <span class="keyword">const</span> Complex&amp; rhs )  <span class="keyword">const</span>  &#123;</span><br><span class="line">        <span class="keyword">return</span> Complex ( r * rhs.r - i * rhs.i, r * rhs.i + i * rhs.r ) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">void</span> <span class="keyword">operator</span> /= ( <span class="keyword">const</span> <span class="keyword">double</span>&amp; x )   &#123;</span><br><span class="line">        r /= x, i /= x ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">void</span> <span class="keyword">operator</span> *= ( <span class="keyword">const</span> Complex&amp; rhs )   &#123;</span><br><span class="line">        *<span class="keyword">this</span> = Complex ( r * rhs.r - i * rhs.i, r * rhs.i + i * rhs.r ) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">void</span> <span class="keyword">operator</span> += ( <span class="keyword">const</span> Complex&amp; rhs )   &#123;</span><br><span class="line">        r += rhs.r, i += rhs.i ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> Complex <span class="title">conj</span> <span class="params">( )</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Complex ( r, -i ) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> ostream&amp; <span class="keyword">operator</span> &lt;&lt; (ostream&amp; out, <span class="keyword">const</span> Complex&amp; cx) &#123;</span><br><span class="line">        out &lt;&lt; <span class="string">"("</span> &lt;&lt; cx.r &lt;&lt; <span class="string">", "</span> &lt;&lt; cx.i &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> istream&amp; <span class="keyword">operator</span> &gt;&gt; (istream&amp; in, Complex&amp; cx) &#123;</span><br><span class="line">        in &gt;&gt; cx.r &gt;&gt; cx.i;</span><br><span class="line">        <span class="keyword">return</span> in;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FastFourierTransform</span>  &#123;</span></span><br><span class="line">    Complex omega [N], omegaInverse [N] ;</span><br><span class="line">    <span class="keyword">int</span> range;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">int</span>&amp; n )</span>  </span>&#123;</span><br><span class="line">        range = n;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i )  &#123;</span><br><span class="line">            omega [i] = Complex ( <span class="built_in">cos</span> ( <span class="number">2</span> * PI / n * i), <span class="built_in">sin</span> ( <span class="number">2</span> * PI / n * i ) ) ;</span><br><span class="line">            omegaInverse [i] = omega [i].conj ( ) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 迭代式二分转换</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transform</span> <span class="params">( Complex *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n, <span class="keyword">const</span> Complex* omega )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span> ; i &lt; n ; ++ i )  &#123;</span><br><span class="line">        <span class="keyword">if</span> ( i &gt; j )  <span class="built_in">std</span> :: swap ( a [i], a [j] ) ;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> l = n &gt;&gt; <span class="number">1</span> ; ( j ^= l ) &lt; l ; l &gt;&gt;= <span class="number">1</span> ) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> l = <span class="number">2</span> ; l &lt;= n ; l &lt;&lt;= <span class="number">1</span> )  &#123;</span><br><span class="line">            <span class="keyword">int</span> m = l / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">for</span> ( Complex *p = a ; p != a + n ; p += l )  &#123;</span><br><span class="line">                <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; m ; ++ i )  &#123;</span><br><span class="line">                    Complex t = omega [range / l * i] * p [m + i] ;</span><br><span class="line">                    p [m + i] = p [i] - t ;</span><br><span class="line">                    p [i] += t ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 时域转频域</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dft</span> <span class="params">( Complex *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n )</span>  </span>&#123;</span><br><span class="line">        transform ( a, n, omega ) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 频域转时域</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">idft</span> <span class="params">( Complex *a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; n )</span>  </span>&#123;</span><br><span class="line">        transform ( a, n, omegaInverse ) ;</span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i ) a [i] /= n ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; fft ;</span><br></pre></td></tr></table></figure>
</details>






</li>
</ul>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ul>
<li><p>加速多项式计算O(nlogn)</p>
<details>
<summary>展开代码</summary>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 应用到加速多项式乘法</span></span><br><span class="line">    <span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; a[<span class="number">500</span>], b[<span class="number">500</span>];</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">cin</span> &gt;&gt; a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) <span class="built_in">cin</span> &gt;&gt; b[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a*b之后的真实系数</span></span><br><span class="line">    <span class="keyword">int</span> r[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">            r[i + j] += a[i].real() * b[j].real();</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"真实系数："</span>；</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n + m - <span class="number">1</span>; i++)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; r[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 利用fft计算得出的系数</span></span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p &lt; n + m - <span class="number">1</span>) p &lt;&lt;= <span class="number">1</span>;  <span class="comment">// 只要p大于多项式结果中的最大次幂即可</span></span><br><span class="line">    fft.init(p);</span><br><span class="line">    fft.dft(a, p);</span><br><span class="line">    fft.dft(b, p);</span><br><span class="line">    <span class="built_in">complex</span>&lt;<span class="keyword">double</span>&gt; c[<span class="number">500</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p; i++) &#123;</span><br><span class="line">        c[i] = a[i] * b[i];</span><br><span class="line">    &#125;</span><br><span class="line">    fft.idft(c, p);</span><br><span class="line">    <span class="comment">// 考虑到精度问题取实部+0.5向下取整</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"fft计算得出的系数："</span>；</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n + m - <span class="number">1</span>; i++) <span class="built_in">cout</span> &lt;&lt; <span class="keyword">int</span>(c[i].real() + <span class="number">0.5</span>) &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>

<p>输入一组数据得到输出结果如下</p>
<div align="center">
    <img src="/images/poly/fft1.png">
</div>


</li>
</ul>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      


  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">

    <link itemprop="mainEntityOfPage" href="https://brooksj.com/2019/07/18/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%A2%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="brooksj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在人间漂流">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/18/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%A2%98%E9%9B%86/" itemprop="url">动态规划题集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-18T10:15:33+08:00">
                2019-07-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithm</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/ACM-Solution/" itemprop="url" rel="index">
                    <span itemprop="name">ACM Solution</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/18/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%A2%98%E9%9B%86/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="https://brooksj.com/2019/07/18/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%A2%98%E9%9B%86/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/18/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%A2%98%E9%9B%86/" class="leancloud_visitors" data-flag-title="动态规划题集">
               <span class="post-meta-divider"><br/></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">字数统计:</span>
            <span class="post-count">553(字)</span>
            
          </span>
	  
          <span class="post-time">
	        &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">阅读时长:</span>
            <span class="post-count">2(分)</span>
          </span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="01背包问题"><a href="#01背包问题" class="headerlink" title="01背包问题"></a>01背包问题</h2><h3 id="HDU-3466"><a href="#HDU-3466" class="headerlink" title="HDU-3466"></a>HDU-3466</h3><p>题目: <a href="http://acm.hdu.edu.cn/showproblem.php?pid=3466" target="_blank" rel="noopener">HDU-3346. Proud Merchants</a></p>
<p>分析:&nbsp;&nbsp;首先对于任意两个物品i和j,如果我们只选他们中的一个或全不选,我们所需要的初始金钱是相同的.现在如果我们对于它们两个都选,初始金钱就跟选择的顺序有关了.比如:</p>
<p>3 5 6</p>
<p>5 10 5</p>
<p>两个物品,如果先1后2,初始需要13,如果先2后1,初始需要10.</p>
<p>对于任意两个物品i和j,如果我们先i后j初始:</p>
<p>金钱= <font color='#DC143C'>Q[i]+Q[j]-(Q[i]-p[i]) = p[i]+Q[j]</font></p>
<p>同理可得先j后i,初始:</p>
<p>金钱= <font color='#DC143C'>Q[j]+Q[i]-(Q[j]-p[j]) = p[j]+Q[i]</font></p>
<p>所以对于i和j,假设我们手上有M金钱,我们肯定先以(Q-P)值从大到小开始选择,这样我才能保证对于同一种选择方案(某些选,某些不选),我们所需要的初始金钱最小.或者换一种说法,给定一定的金额,如果按照(Q-P)值从大到小的顺序进行选择,可以获得尽可能多的物品.</p>
<p><strong>solution:</strong>&nbsp;&nbsp;01背包+贪心,关键在于找到要进行贪心的值</p>
<p><strong>implementation:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*******************************************************************************</span></span><br><span class="line"><span class="comment">Author: liujian</span></span><br><span class="line"><span class="comment">Email: brooksj@foxmail.com</span></span><br><span class="line"><span class="comment">Date: 2019-07-18 10:51</span></span><br><span class="line"><span class="comment">File: hdu_3466.cpp</span></span><br><span class="line"><span class="comment">Last modified: 2019-07-18 10:51</span></span><br><span class="line"><span class="comment">*******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(<span class="meta-string">"O2"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5</span> * <span class="number">1e2</span> + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">5</span> * <span class="number">1e3</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">item</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> p, q, v;</span><br><span class="line">    item(<span class="keyword">int</span> _p = <span class="number">0</span>, <span class="keyword">int</span> _q = <span class="number">0</span>, <span class="keyword">int</span> _v = <span class="number">0</span>):p(_p),q(_q),v(_v)&#123;&#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> item &amp;a, <span class="keyword">const</span> item &amp;b) &#123;</span><br><span class="line">        <span class="keyword">return</span> (a.q - a.p) &lt; (b.q - b.p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dp[maxm], sum[maxn];</span><br><span class="line">item items[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m) &#123;</span><br><span class="line">        sum[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; items[i].p &gt;&gt; items[i].q &gt;&gt; items[i].v;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(items + <span class="number">1</span>, items + n + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            sum[i] = sum[i - <span class="number">1</span>] + items[i].p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= m; i++) &#123;</span><br><span class="line">            dp[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">           <span class="keyword">int</span> lowerb = <span class="built_in">max</span>(<span class="built_in">max</span>(m - sum[n] + sum[i], items[i].p), items[i].q);</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = m; j &gt;= lowerb; j--) &#123;</span><br><span class="line">               dp[j] = <span class="built_in">max</span>(dp[j], dp[j - items[i].p] + items[i].v);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; dp[m] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
    
    <!-- 文章结束分割线 -->
    <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

    

    

    
    
    <div>
	    <p id="div-border-left-red">
	    <span>
        <b>作者: brooksjay</b><br/>
        <b>联系邮箱: jaypark@smail.nju.edu.cn</b><br/>
	    <b>本文地址: </b><a href="/page/2/index.html" title=""></a><br/>
	    <b>本文基于<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br/>
        <b>转载请注明出处, 谢谢！</b>
	    </span>
	    </p>
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="brooksj" />
            
              <p class="site-author-name" itemprop="name">brooksj</p>
              <p class="site-description motion-element" itemprop="description">我听说虫洞可以穿梭时空</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/tracy-talent" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jaypark@smail.nju.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/brooksj" title="博客旧址" target="_blank">博客旧址</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://kexue.fm" title="苏剑林's blog" target="_blank">苏剑林's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://karpathy.github.io" title="Karpathy's Blog" target="_blank">Karpathy's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://ruder.io" title="Ruder's Blog" target="_blank">Ruder's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://medium.com/@makcedward" title="Edward Ma's Blog" target="_blank">Edward Ma's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.miskcoo.com" title="Miskcoo's Blog" target="_blank">Miskcoo's Blog</a>
                  </li>
                
              </ul>
            </div>
          

          <div id="days"></div>
    <script>
    function show_date_time(){
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date("04/20/2019 15:00:00");
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=setzero(Math.floor(e_hrsold));
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
        seconds=setzero(Math.floor((e_minsold-minsold)*60));
        document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
    }
function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
}
show_date_time();
</script>

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">brooksj</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("AJCfamp9AdxK89MonULcgI68-gzGzoHsz", "sVrhDpWMN5wNlfAPwgDHdxPL");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
